c73e6916b45a3077ee3199aae89c8ea0












'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}

var AnimatedValue=require('../nodes/AnimatedValue');
var AnimatedValueXY=require('../nodes/AnimatedValueXY');
var Animation=require('./Animation');
var SpringConfig=require('../SpringConfig');

var invariant=require('fbjs/lib/invariant');var _require=
require('../NativeAnimatedHelper'),shouldUseNativeDriver=_require.shouldUseNativeDriver;



































function withDefault(value,defaultValue){
if(value===undefined||value===null){
return defaultValue;
}
return value;
}var

SpringAnimation=function(_Animation){_inherits(SpringAnimation,_Animation);





















function SpringAnimation(config){_classCallCheck(this,SpringAnimation);var _this=_possibleConstructorReturn(this,(SpringAnimation.__proto__||Object.getPrototypeOf(SpringAnimation)).call(this));


_this._overshootClamping=withDefault(config.overshootClamping,false);
_this._restDisplacementThreshold=withDefault(
config.restDisplacementThreshold,
0.001);

_this._restSpeedThreshold=withDefault(config.restSpeedThreshold,0.001);
_this._initialVelocity=withDefault(config.velocity,0);
_this._lastVelocity=withDefault(config.velocity,0);
_this._toValue=config.toValue;
_this._delay=withDefault(config.delay,0);
_this._useNativeDriver=shouldUseNativeDriver(config);
_this.__isInteraction=
config.isInteraction!==undefined?config.isInteraction:true;
_this.__iterations=config.iterations!==undefined?config.iterations:1;

if(
config.stiffness!==undefined||
config.damping!==undefined||
config.mass!==undefined)
{
invariant(
config.bounciness===undefined&&
config.speed===undefined&&
config.tension===undefined&&
config.friction===undefined,
'You can define one of bounciness/speed, tension/friction, or stiffness/damping/mass, but not more than one');

_this._stiffness=withDefault(config.stiffness,100);
_this._damping=withDefault(config.damping,10);
_this._mass=withDefault(config.mass,1);
}else if(config.bounciness!==undefined||config.speed!==undefined){


invariant(
config.tension===undefined&&
config.friction===undefined&&
config.stiffness===undefined&&
config.damping===undefined&&
config.mass===undefined,
'You can define one of bounciness/speed, tension/friction, or stiffness/damping/mass, but not more than one');

var springConfig=SpringConfig.fromBouncinessAndSpeed(
withDefault(config.bounciness,8),
withDefault(config.speed,12));

_this._stiffness=springConfig.stiffness;
_this._damping=springConfig.damping;
_this._mass=1;
}else{


var _springConfig=SpringConfig.fromOrigamiTensionAndFriction(
withDefault(config.tension,40),
withDefault(config.friction,7));

_this._stiffness=_springConfig.stiffness;
_this._damping=_springConfig.damping;
_this._mass=1;
}

invariant(_this._stiffness>0,'Stiffness value must be greater than 0');
invariant(_this._damping>0,'Damping value must be greater than 0');
invariant(_this._mass>0,'Mass value must be greater than 0');return _this;
}_createClass(SpringAnimation,[{key:'__getNativeAnimationConfig',value:function __getNativeAnimationConfig()

{
return{
type:'spring',
overshootClamping:this._overshootClamping,
restDisplacementThreshold:this._restDisplacementThreshold,
restSpeedThreshold:this._restSpeedThreshold,
stiffness:this._stiffness,
damping:this._damping,
mass:this._mass,
initialVelocity:withDefault(this._initialVelocity,this._lastVelocity),
toValue:this._toValue,
iterations:this.__iterations};

}},{key:'start',value:function start(


fromValue,
onUpdate,
onEnd,
previousAnimation,
animatedValue)
{var _this2=this;
this.__active=true;
this._startPosition=fromValue;
this._lastPosition=this._startPosition;

this._onUpdate=onUpdate;
this.__onEnd=onEnd;
this._lastTime=Date.now();
this._frameTime=0.0;

if(previousAnimation instanceof SpringAnimation){
var internalState=previousAnimation.getInternalState();
this._lastPosition=internalState.lastPosition;
this._lastVelocity=internalState.lastVelocity;

this._initialVelocity=this._lastVelocity;
this._lastTime=internalState.lastTime;
}

var start=function start(){
if(_this2._useNativeDriver){
_this2.__startNativeAnimation(animatedValue);
}else{
_this2.onUpdate();
}
};


if(this._delay){
this._timeout=setTimeout(start,this._delay);
}else{
start();
}
}},{key:'getInternalState',value:function getInternalState()

{
return{
lastPosition:this._lastPosition,
lastVelocity:this._lastVelocity,
lastTime:this._lastTime};

}},{key:'onUpdate',value:function onUpdate()






















{




var MAX_STEPS=64;
var now=Date.now();
if(now>this._lastTime+MAX_STEPS){
now=this._lastTime+MAX_STEPS;
}

var deltaTime=(now-this._lastTime)/1000;
this._frameTime+=deltaTime;

var c=this._damping;
var m=this._mass;
var k=this._stiffness;
var v0=-this._initialVelocity;

var zeta=c/(2*Math.sqrt(k*m));
var omega0=Math.sqrt(k/m);
var omega1=omega0*Math.sqrt(1.0-zeta*zeta);
var x0=this._toValue-this._startPosition;

var position=0.0;
var velocity=0.0;
var t=this._frameTime;
if(zeta<1){

var envelope=Math.exp(-zeta*omega0*t);
position=
this._toValue-
envelope*(
(v0+zeta*omega0*x0)/omega1*Math.sin(omega1*t)+
x0*Math.cos(omega1*t));


velocity=
zeta*
omega0*
envelope*(
Math.sin(omega1*t)*(v0+zeta*omega0*x0)/omega1+
x0*Math.cos(omega1*t))-
envelope*(
Math.cos(omega1*t)*(v0+zeta*omega0*x0)-
omega1*x0*Math.sin(omega1*t));
}else{

var _envelope=Math.exp(-omega0*t);
position=this._toValue-_envelope*(x0+(v0+omega0*x0)*t);
velocity=
_envelope*(v0*(t*omega0-1)+t*x0*(omega0*omega0));
}

this._lastTime=now;
this._lastPosition=position;
this._lastVelocity=velocity;

this._onUpdate(position);
if(!this.__active){

return;
}


var isOvershooting=false;
if(this._overshootClamping&&this._stiffness!==0){
if(this._startPosition<this._toValue){
isOvershooting=position>this._toValue;
}else{
isOvershooting=position<this._toValue;
}
}
var isVelocity=Math.abs(velocity)<=this._restSpeedThreshold;
var isDisplacement=true;
if(this._stiffness!==0){
isDisplacement=
Math.abs(this._toValue-position)<=this._restDisplacementThreshold;
}

if(isOvershooting||isVelocity&&isDisplacement){
if(this._stiffness!==0){

this._lastPosition=this._toValue;
this._lastVelocity=0;
this._onUpdate(this._toValue);
}

this.__debouncedOnEnd({finished:true});
return;
}
this._animationFrame=requestAnimationFrame(this.onUpdate.bind(this));
}},{key:'stop',value:function stop()

{
_get(SpringAnimation.prototype.__proto__||Object.getPrototypeOf(SpringAnimation.prototype),'stop',this).call(this);
this.__active=false;
clearTimeout(this._timeout);
global.cancelAnimationFrame(this._animationFrame);
this.__debouncedOnEnd({finished:false});
}}]);return SpringAnimation;}(Animation);


module.exports=SpringAnimation;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNwcmluZ0FuaW1hdGlvbi5qcyJdLCJuYW1lcyI6WyJBbmltYXRlZFZhbHVlIiwicmVxdWlyZSIsIkFuaW1hdGVkVmFsdWVYWSIsIkFuaW1hdGlvbiIsIlNwcmluZ0NvbmZpZyIsImludmFyaWFudCIsInNob3VsZFVzZU5hdGl2ZURyaXZlciIsIndpdGhEZWZhdWx0IiwidmFsdWUiLCJkZWZhdWx0VmFsdWUiLCJ1bmRlZmluZWQiLCJTcHJpbmdBbmltYXRpb24iLCJjb25maWciLCJfb3ZlcnNob290Q2xhbXBpbmciLCJvdmVyc2hvb3RDbGFtcGluZyIsIl9yZXN0RGlzcGxhY2VtZW50VGhyZXNob2xkIiwicmVzdERpc3BsYWNlbWVudFRocmVzaG9sZCIsIl9yZXN0U3BlZWRUaHJlc2hvbGQiLCJyZXN0U3BlZWRUaHJlc2hvbGQiLCJfaW5pdGlhbFZlbG9jaXR5IiwidmVsb2NpdHkiLCJfbGFzdFZlbG9jaXR5IiwiX3RvVmFsdWUiLCJ0b1ZhbHVlIiwiX2RlbGF5IiwiZGVsYXkiLCJfdXNlTmF0aXZlRHJpdmVyIiwiX19pc0ludGVyYWN0aW9uIiwiaXNJbnRlcmFjdGlvbiIsIl9faXRlcmF0aW9ucyIsIml0ZXJhdGlvbnMiLCJzdGlmZm5lc3MiLCJkYW1waW5nIiwibWFzcyIsImJvdW5jaW5lc3MiLCJzcGVlZCIsInRlbnNpb24iLCJmcmljdGlvbiIsIl9zdGlmZm5lc3MiLCJfZGFtcGluZyIsIl9tYXNzIiwic3ByaW5nQ29uZmlnIiwiZnJvbUJvdW5jaW5lc3NBbmRTcGVlZCIsImZyb21PcmlnYW1pVGVuc2lvbkFuZEZyaWN0aW9uIiwidHlwZSIsImluaXRpYWxWZWxvY2l0eSIsImZyb21WYWx1ZSIsIm9uVXBkYXRlIiwib25FbmQiLCJwcmV2aW91c0FuaW1hdGlvbiIsImFuaW1hdGVkVmFsdWUiLCJfX2FjdGl2ZSIsIl9zdGFydFBvc2l0aW9uIiwiX2xhc3RQb3NpdGlvbiIsIl9vblVwZGF0ZSIsIl9fb25FbmQiLCJfbGFzdFRpbWUiLCJEYXRlIiwibm93IiwiX2ZyYW1lVGltZSIsImludGVybmFsU3RhdGUiLCJnZXRJbnRlcm5hbFN0YXRlIiwibGFzdFBvc2l0aW9uIiwibGFzdFZlbG9jaXR5IiwibGFzdFRpbWUiLCJzdGFydCIsIl9fc3RhcnROYXRpdmVBbmltYXRpb24iLCJfdGltZW91dCIsInNldFRpbWVvdXQiLCJNQVhfU1RFUFMiLCJkZWx0YVRpbWUiLCJjIiwibSIsImsiLCJ2MCIsInpldGEiLCJNYXRoIiwic3FydCIsIm9tZWdhMCIsIm9tZWdhMSIsIngwIiwicG9zaXRpb24iLCJ0IiwiZW52ZWxvcGUiLCJleHAiLCJzaW4iLCJjb3MiLCJpc092ZXJzaG9vdGluZyIsImlzVmVsb2NpdHkiLCJhYnMiLCJpc0Rpc3BsYWNlbWVudCIsIl9fZGVib3VuY2VkT25FbmQiLCJmaW5pc2hlZCIsIl9hbmltYXRpb25GcmFtZSIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImJpbmQiLCJjbGVhclRpbWVvdXQiLCJnbG9iYWwiLCJjYW5jZWxBbmltYXRpb25GcmFtZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQVlBLGE7O0FBRUEsR0FBTUEsZUFBZ0JDLFFBQVEsd0JBQVIsQ0FBdEI7QUFDQSxHQUFNQyxpQkFBa0JELFFBQVEsMEJBQVIsQ0FBeEI7QUFDQSxHQUFNRSxXQUFZRixRQUFRLGFBQVIsQ0FBbEI7QUFDQSxHQUFNRyxjQUFlSCxRQUFRLGlCQUFSLENBQXJCOztBQUVBLEdBQU1JLFdBQVlKLFFBQVEsb0JBQVIsQ0FBbEIsQztBQUNnQ0EsUUFBUSx5QkFBUixDLENBQXpCSyxxQixVQUFBQSxxQjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0NQLFFBQVNDLFlBQVQsQ0FBd0JDLEtBQXhCLENBQW1DQyxZQUFuQyxDQUF1RDtBQUNyRCxHQUFJRCxRQUFVRSxTQUFWLEVBQXVCRixRQUFVLElBQXJDLENBQTJDO0FBQ3pDLE1BQU9DLGFBQVA7QUFDRDtBQUNELE1BQU9ELE1BQVA7QUFDRCxDOztB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QUFLRCxhQUFMLENBQXFCLENBQXJCO0FBQ0EsS0FBS2lDLFNBQUwsQ0FBZSxLQUFLaEMsUUFBcEI7QUFDRDs7QUFFRCxLQUFLcUUsZ0JBQUwsQ0FBc0IsQ0FBQ0MsU0FBVSxJQUFYLENBQXRCO0FBQ0E7QUFDRDtBQUNELEtBQUtDLGVBQUwsQ0FBdUJDLHNCQUFzQixLQUFLL0MsUUFBTCxDQUFjZ0QsSUFBZCxDQUFtQixJQUFuQixDQUF0QixDQUF2QjtBQUNELEM7O0FBRVk7QUFDWDtBQUNBLEtBQUs1QyxRQUFMLENBQWdCLEtBQWhCO0FBQ0E2QyxhQUFhLEtBQUs3QixRQUFsQjtBQUNBOEIsT0FBT0Msb0JBQVAsQ0FBNEIsS0FBS0wsZUFBakM7QUFDQSxLQUFLRixnQkFBTCxDQUFzQixDQUFDQyxTQUFVLEtBQVgsQ0FBdEI7QUFDRCxDLDZCQW5SMkJ6RixTOzs7QUFzUjlCZ0csT0FBT0MsT0FBUCxDQUFpQnpGLGVBQWpCIiwiZmlsZSI6IlNwcmluZ0FuaW1hdGlvbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cbiAqXG4gKiBAcHJvdmlkZXNNb2R1bGUgU3ByaW5nQW5pbWF0aW9uXG4gKiBAZmxvd1xuICogQGZvcm1hdFxuICovXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IEFuaW1hdGVkVmFsdWUgPSByZXF1aXJlKCcuLi9ub2Rlcy9BbmltYXRlZFZhbHVlJyk7XG5jb25zdCBBbmltYXRlZFZhbHVlWFkgPSByZXF1aXJlKCcuLi9ub2Rlcy9BbmltYXRlZFZhbHVlWFknKTtcbmNvbnN0IEFuaW1hdGlvbiA9IHJlcXVpcmUoJy4vQW5pbWF0aW9uJyk7XG5jb25zdCBTcHJpbmdDb25maWcgPSByZXF1aXJlKCcuLi9TcHJpbmdDb25maWcnKTtcblxuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnZmJqcy9saWIvaW52YXJpYW50Jyk7XG5jb25zdCB7c2hvdWxkVXNlTmF0aXZlRHJpdmVyfSA9IHJlcXVpcmUoJy4uL05hdGl2ZUFuaW1hdGVkSGVscGVyJyk7XG5cbmltcG9ydCB0eXBlIHtBbmltYXRpb25Db25maWcsIEVuZENhbGxiYWNrfSBmcm9tICcuL0FuaW1hdGlvbic7XG5cbmV4cG9ydCB0eXBlIFNwcmluZ0FuaW1hdGlvbkNvbmZpZyA9IEFuaW1hdGlvbkNvbmZpZyAmIHtcbiAgdG9WYWx1ZTogbnVtYmVyIHwgQW5pbWF0ZWRWYWx1ZSB8IHt4OiBudW1iZXIsIHk6IG51bWJlcn0gfCBBbmltYXRlZFZhbHVlWFksXG4gIG92ZXJzaG9vdENsYW1waW5nPzogYm9vbGVhbixcbiAgcmVzdERpc3BsYWNlbWVudFRocmVzaG9sZD86IG51bWJlcixcbiAgcmVzdFNwZWVkVGhyZXNob2xkPzogbnVtYmVyLFxuICB2ZWxvY2l0eT86IG51bWJlciB8IHt4OiBudW1iZXIsIHk6IG51bWJlcn0sXG4gIGJvdW5jaW5lc3M/OiBudW1iZXIsXG4gIHNwZWVkPzogbnVtYmVyLFxuICB0ZW5zaW9uPzogbnVtYmVyLFxuICBmcmljdGlvbj86IG51bWJlcixcbiAgc3RpZmZuZXNzPzogbnVtYmVyLFxuICBkYW1waW5nPzogbnVtYmVyLFxuICBtYXNzPzogbnVtYmVyLFxuICBkZWxheT86IG51bWJlcixcbn07XG5cbmV4cG9ydCB0eXBlIFNwcmluZ0FuaW1hdGlvbkNvbmZpZ1NpbmdsZSA9IEFuaW1hdGlvbkNvbmZpZyAmIHtcbiAgdG9WYWx1ZTogbnVtYmVyIHwgQW5pbWF0ZWRWYWx1ZSxcbiAgb3ZlcnNob290Q2xhbXBpbmc/OiBib29sZWFuLFxuICByZXN0RGlzcGxhY2VtZW50VGhyZXNob2xkPzogbnVtYmVyLFxuICByZXN0U3BlZWRUaHJlc2hvbGQ/OiBudW1iZXIsXG4gIHZlbG9jaXR5PzogbnVtYmVyLFxuICBib3VuY2luZXNzPzogbnVtYmVyLFxuICBzcGVlZD86IG51bWJlcixcbiAgdGVuc2lvbj86IG51bWJlcixcbiAgZnJpY3Rpb24/OiBudW1iZXIsXG4gIHN0aWZmbmVzcz86IG51bWJlcixcbiAgZGFtcGluZz86IG51bWJlcixcbiAgbWFzcz86IG51bWJlcixcbiAgZGVsYXk/OiBudW1iZXIsXG59O1xuXG5mdW5jdGlvbiB3aXRoRGVmYXVsdDxUPih2YWx1ZTogP1QsIGRlZmF1bHRWYWx1ZTogVCk6IFQge1xuICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCkge1xuICAgIHJldHVybiBkZWZhdWx0VmFsdWU7XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG5jbGFzcyBTcHJpbmdBbmltYXRpb24gZXh0ZW5kcyBBbmltYXRpb24ge1xuICBfb3ZlcnNob290Q2xhbXBpbmc6IGJvb2xlYW47XG4gIF9yZXN0RGlzcGxhY2VtZW50VGhyZXNob2xkOiBudW1iZXI7XG4gIF9yZXN0U3BlZWRUaHJlc2hvbGQ6IG51bWJlcjtcbiAgX2xhc3RWZWxvY2l0eTogbnVtYmVyO1xuICBfc3RhcnRQb3NpdGlvbjogbnVtYmVyO1xuICBfbGFzdFBvc2l0aW9uOiBudW1iZXI7XG4gIF9mcm9tVmFsdWU6IG51bWJlcjtcbiAgX3RvVmFsdWU6IGFueTtcbiAgX3N0aWZmbmVzczogbnVtYmVyO1xuICBfZGFtcGluZzogbnVtYmVyO1xuICBfbWFzczogbnVtYmVyO1xuICBfaW5pdGlhbFZlbG9jaXR5OiBudW1iZXI7XG4gIF9kZWxheTogbnVtYmVyO1xuICBfdGltZW91dDogYW55O1xuICBfc3RhcnRUaW1lOiBudW1iZXI7XG4gIF9sYXN0VGltZTogbnVtYmVyO1xuICBfZnJhbWVUaW1lOiBudW1iZXI7XG4gIF9vblVwZGF0ZTogKHZhbHVlOiBudW1iZXIpID0+IHZvaWQ7XG4gIF9hbmltYXRpb25GcmFtZTogYW55O1xuICBfdXNlTmF0aXZlRHJpdmVyOiBib29sZWFuO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogU3ByaW5nQW5pbWF0aW9uQ29uZmlnU2luZ2xlKSB7XG4gICAgc3VwZXIoKTtcblxuICAgIHRoaXMuX292ZXJzaG9vdENsYW1waW5nID0gd2l0aERlZmF1bHQoY29uZmlnLm92ZXJzaG9vdENsYW1waW5nLCBmYWxzZSk7XG4gICAgdGhpcy5fcmVzdERpc3BsYWNlbWVudFRocmVzaG9sZCA9IHdpdGhEZWZhdWx0KFxuICAgICAgY29uZmlnLnJlc3REaXNwbGFjZW1lbnRUaHJlc2hvbGQsXG4gICAgICAwLjAwMSxcbiAgICApO1xuICAgIHRoaXMuX3Jlc3RTcGVlZFRocmVzaG9sZCA9IHdpdGhEZWZhdWx0KGNvbmZpZy5yZXN0U3BlZWRUaHJlc2hvbGQsIDAuMDAxKTtcbiAgICB0aGlzLl9pbml0aWFsVmVsb2NpdHkgPSB3aXRoRGVmYXVsdChjb25maWcudmVsb2NpdHksIDApO1xuICAgIHRoaXMuX2xhc3RWZWxvY2l0eSA9IHdpdGhEZWZhdWx0KGNvbmZpZy52ZWxvY2l0eSwgMCk7XG4gICAgdGhpcy5fdG9WYWx1ZSA9IGNvbmZpZy50b1ZhbHVlO1xuICAgIHRoaXMuX2RlbGF5ID0gd2l0aERlZmF1bHQoY29uZmlnLmRlbGF5LCAwKTtcbiAgICB0aGlzLl91c2VOYXRpdmVEcml2ZXIgPSBzaG91bGRVc2VOYXRpdmVEcml2ZXIoY29uZmlnKTtcbiAgICB0aGlzLl9faXNJbnRlcmFjdGlvbiA9XG4gICAgICBjb25maWcuaXNJbnRlcmFjdGlvbiAhPT0gdW5kZWZpbmVkID8gY29uZmlnLmlzSW50ZXJhY3Rpb24gOiB0cnVlO1xuICAgIHRoaXMuX19pdGVyYXRpb25zID0gY29uZmlnLml0ZXJhdGlvbnMgIT09IHVuZGVmaW5lZCA/IGNvbmZpZy5pdGVyYXRpb25zIDogMTtcblxuICAgIGlmIChcbiAgICAgIGNvbmZpZy5zdGlmZm5lc3MgIT09IHVuZGVmaW5lZCB8fFxuICAgICAgY29uZmlnLmRhbXBpbmcgIT09IHVuZGVmaW5lZCB8fFxuICAgICAgY29uZmlnLm1hc3MgIT09IHVuZGVmaW5lZFxuICAgICkge1xuICAgICAgaW52YXJpYW50KFxuICAgICAgICBjb25maWcuYm91bmNpbmVzcyA9PT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgY29uZmlnLnNwZWVkID09PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICBjb25maWcudGVuc2lvbiA9PT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgY29uZmlnLmZyaWN0aW9uID09PSB1bmRlZmluZWQsXG4gICAgICAgICdZb3UgY2FuIGRlZmluZSBvbmUgb2YgYm91bmNpbmVzcy9zcGVlZCwgdGVuc2lvbi9mcmljdGlvbiwgb3Igc3RpZmZuZXNzL2RhbXBpbmcvbWFzcywgYnV0IG5vdCBtb3JlIHRoYW4gb25lJyxcbiAgICAgICk7XG4gICAgICB0aGlzLl9zdGlmZm5lc3MgPSB3aXRoRGVmYXVsdChjb25maWcuc3RpZmZuZXNzLCAxMDApO1xuICAgICAgdGhpcy5fZGFtcGluZyA9IHdpdGhEZWZhdWx0KGNvbmZpZy5kYW1waW5nLCAxMCk7XG4gICAgICB0aGlzLl9tYXNzID0gd2l0aERlZmF1bHQoY29uZmlnLm1hc3MsIDEpO1xuICAgIH0gZWxzZSBpZiAoY29uZmlnLmJvdW5jaW5lc3MgIT09IHVuZGVmaW5lZCB8fCBjb25maWcuc3BlZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgLy8gQ29udmVydCB0aGUgb3JpZ2FtaSBib3VuY2luZXNzL3NwZWVkIHZhbHVlcyB0byBzdGlmZm5lc3MvZGFtcGluZ1xuICAgICAgLy8gV2UgYXNzdW1lIG1hc3MgaXMgMS5cbiAgICAgIGludmFyaWFudChcbiAgICAgICAgY29uZmlnLnRlbnNpb24gPT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgIGNvbmZpZy5mcmljdGlvbiA9PT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgY29uZmlnLnN0aWZmbmVzcyA9PT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgY29uZmlnLmRhbXBpbmcgPT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgIGNvbmZpZy5tYXNzID09PSB1bmRlZmluZWQsXG4gICAgICAgICdZb3UgY2FuIGRlZmluZSBvbmUgb2YgYm91bmNpbmVzcy9zcGVlZCwgdGVuc2lvbi9mcmljdGlvbiwgb3Igc3RpZmZuZXNzL2RhbXBpbmcvbWFzcywgYnV0IG5vdCBtb3JlIHRoYW4gb25lJyxcbiAgICAgICk7XG4gICAgICBjb25zdCBzcHJpbmdDb25maWcgPSBTcHJpbmdDb25maWcuZnJvbUJvdW5jaW5lc3NBbmRTcGVlZChcbiAgICAgICAgd2l0aERlZmF1bHQoY29uZmlnLmJvdW5jaW5lc3MsIDgpLFxuICAgICAgICB3aXRoRGVmYXVsdChjb25maWcuc3BlZWQsIDEyKSxcbiAgICAgICk7XG4gICAgICB0aGlzLl9zdGlmZm5lc3MgPSBzcHJpbmdDb25maWcuc3RpZmZuZXNzO1xuICAgICAgdGhpcy5fZGFtcGluZyA9IHNwcmluZ0NvbmZpZy5kYW1waW5nO1xuICAgICAgdGhpcy5fbWFzcyA9IDE7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIENvbnZlcnQgdGhlIG9yaWdhbWkgdGVuc2lvbi9mcmljdGlvbiB2YWx1ZXMgdG8gc3RpZmZuZXNzL2RhbXBpbmdcbiAgICAgIC8vIFdlIGFzc3VtZSBtYXNzIGlzIDEuXG4gICAgICBjb25zdCBzcHJpbmdDb25maWcgPSBTcHJpbmdDb25maWcuZnJvbU9yaWdhbWlUZW5zaW9uQW5kRnJpY3Rpb24oXG4gICAgICAgIHdpdGhEZWZhdWx0KGNvbmZpZy50ZW5zaW9uLCA0MCksXG4gICAgICAgIHdpdGhEZWZhdWx0KGNvbmZpZy5mcmljdGlvbiwgNyksXG4gICAgICApO1xuICAgICAgdGhpcy5fc3RpZmZuZXNzID0gc3ByaW5nQ29uZmlnLnN0aWZmbmVzcztcbiAgICAgIHRoaXMuX2RhbXBpbmcgPSBzcHJpbmdDb25maWcuZGFtcGluZztcbiAgICAgIHRoaXMuX21hc3MgPSAxO1xuICAgIH1cblxuICAgIGludmFyaWFudCh0aGlzLl9zdGlmZm5lc3MgPiAwLCAnU3RpZmZuZXNzIHZhbHVlIG11c3QgYmUgZ3JlYXRlciB0aGFuIDAnKTtcbiAgICBpbnZhcmlhbnQodGhpcy5fZGFtcGluZyA+IDAsICdEYW1waW5nIHZhbHVlIG11c3QgYmUgZ3JlYXRlciB0aGFuIDAnKTtcbiAgICBpbnZhcmlhbnQodGhpcy5fbWFzcyA+IDAsICdNYXNzIHZhbHVlIG11c3QgYmUgZ3JlYXRlciB0aGFuIDAnKTtcbiAgfVxuXG4gIF9fZ2V0TmF0aXZlQW5pbWF0aW9uQ29uZmlnKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAnc3ByaW5nJyxcbiAgICAgIG92ZXJzaG9vdENsYW1waW5nOiB0aGlzLl9vdmVyc2hvb3RDbGFtcGluZyxcbiAgICAgIHJlc3REaXNwbGFjZW1lbnRUaHJlc2hvbGQ6IHRoaXMuX3Jlc3REaXNwbGFjZW1lbnRUaHJlc2hvbGQsXG4gICAgICByZXN0U3BlZWRUaHJlc2hvbGQ6IHRoaXMuX3Jlc3RTcGVlZFRocmVzaG9sZCxcbiAgICAgIHN0aWZmbmVzczogdGhpcy5fc3RpZmZuZXNzLFxuICAgICAgZGFtcGluZzogdGhpcy5fZGFtcGluZyxcbiAgICAgIG1hc3M6IHRoaXMuX21hc3MsXG4gICAgICBpbml0aWFsVmVsb2NpdHk6IHdpdGhEZWZhdWx0KHRoaXMuX2luaXRpYWxWZWxvY2l0eSwgdGhpcy5fbGFzdFZlbG9jaXR5KSxcbiAgICAgIHRvVmFsdWU6IHRoaXMuX3RvVmFsdWUsXG4gICAgICBpdGVyYXRpb25zOiB0aGlzLl9faXRlcmF0aW9ucyxcbiAgICB9O1xuICB9XG5cbiAgc3RhcnQoXG4gICAgZnJvbVZhbHVlOiBudW1iZXIsXG4gICAgb25VcGRhdGU6ICh2YWx1ZTogbnVtYmVyKSA9PiB2b2lkLFxuICAgIG9uRW5kOiA/RW5kQ2FsbGJhY2ssXG4gICAgcHJldmlvdXNBbmltYXRpb246ID9BbmltYXRpb24sXG4gICAgYW5pbWF0ZWRWYWx1ZTogQW5pbWF0ZWRWYWx1ZSxcbiAgKTogdm9pZCB7XG4gICAgdGhpcy5fX2FjdGl2ZSA9IHRydWU7XG4gICAgdGhpcy5fc3RhcnRQb3NpdGlvbiA9IGZyb21WYWx1ZTtcbiAgICB0aGlzLl9sYXN0UG9zaXRpb24gPSB0aGlzLl9zdGFydFBvc2l0aW9uO1xuXG4gICAgdGhpcy5fb25VcGRhdGUgPSBvblVwZGF0ZTtcbiAgICB0aGlzLl9fb25FbmQgPSBvbkVuZDtcbiAgICB0aGlzLl9sYXN0VGltZSA9IERhdGUubm93KCk7XG4gICAgdGhpcy5fZnJhbWVUaW1lID0gMC4wO1xuXG4gICAgaWYgKHByZXZpb3VzQW5pbWF0aW9uIGluc3RhbmNlb2YgU3ByaW5nQW5pbWF0aW9uKSB7XG4gICAgICBjb25zdCBpbnRlcm5hbFN0YXRlID0gcHJldmlvdXNBbmltYXRpb24uZ2V0SW50ZXJuYWxTdGF0ZSgpO1xuICAgICAgdGhpcy5fbGFzdFBvc2l0aW9uID0gaW50ZXJuYWxTdGF0ZS5sYXN0UG9zaXRpb247XG4gICAgICB0aGlzLl9sYXN0VmVsb2NpdHkgPSBpbnRlcm5hbFN0YXRlLmxhc3RWZWxvY2l0eTtcbiAgICAgIC8vIFNldCB0aGUgaW5pdGlhbCB2ZWxvY2l0eSB0byB0aGUgbGFzdCB2ZWxvY2l0eVxuICAgICAgdGhpcy5faW5pdGlhbFZlbG9jaXR5ID0gdGhpcy5fbGFzdFZlbG9jaXR5O1xuICAgICAgdGhpcy5fbGFzdFRpbWUgPSBpbnRlcm5hbFN0YXRlLmxhc3RUaW1lO1xuICAgIH1cblxuICAgIGNvbnN0IHN0YXJ0ID0gKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuX3VzZU5hdGl2ZURyaXZlcikge1xuICAgICAgICB0aGlzLl9fc3RhcnROYXRpdmVBbmltYXRpb24oYW5pbWF0ZWRWYWx1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm9uVXBkYXRlKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vICBJZiB0aGlzLl9kZWxheSBpcyBtb3JlIHRoYW4gMCwgd2Ugc3RhcnQgYWZ0ZXIgdGhlIHRpbWVvdXQuXG4gICAgaWYgKHRoaXMuX2RlbGF5KSB7XG4gICAgICB0aGlzLl90aW1lb3V0ID0gc2V0VGltZW91dChzdGFydCwgdGhpcy5fZGVsYXkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdGFydCgpO1xuICAgIH1cbiAgfVxuXG4gIGdldEludGVybmFsU3RhdGUoKTogT2JqZWN0IHtcbiAgICByZXR1cm4ge1xuICAgICAgbGFzdFBvc2l0aW9uOiB0aGlzLl9sYXN0UG9zaXRpb24sXG4gICAgICBsYXN0VmVsb2NpdHk6IHRoaXMuX2xhc3RWZWxvY2l0eSxcbiAgICAgIGxhc3RUaW1lOiB0aGlzLl9sYXN0VGltZSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFRoaXMgc3ByaW5nIG1vZGVsIGlzIGJhc2VkIG9mZiBvZiBhIGRhbXBlZCBoYXJtb25pYyBvc2NpbGxhdG9yXG4gICAqIChodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9IYXJtb25pY19vc2NpbGxhdG9yI0RhbXBlZF9oYXJtb25pY19vc2NpbGxhdG9yKS5cbiAgICpcbiAgICogV2UgdXNlIHRoZSBjbG9zZWQgZm9ybSBvZiB0aGUgc2Vjb25kIG9yZGVyIGRpZmZlcmVudGlhbCBlcXVhdGlvbjpcbiAgICpcbiAgICogeCcnICsgKDLOtuKNtV8wKXgnICsg4o21XjJ4ID0gMFxuICAgKlxuICAgKiB3aGVyZVxuICAgKiAgICDijbVfMCA9IOKImihrIC8gbSkgKHVuZGFtcGVkIGFuZ3VsYXIgZnJlcXVlbmN5IG9mIHRoZSBvc2NpbGxhdG9yKSxcbiAgICogICAgzrYgPSBjIC8gMuKImm1rIChkYW1waW5nIHJhdGlvKSxcbiAgICogICAgYyA9IGRhbXBpbmcgY29uc3RhbnRcbiAgICogICAgayA9IHN0aWZmbmVzc1xuICAgKiAgICBtID0gbWFzc1xuICAgKlxuICAgKiBUaGUgZGVyaXZhdGlvbiBvZiB0aGUgY2xvc2VkIGZvcm0gaXMgZGVzY3JpYmVkIGluIGRldGFpbCBoZXJlOlxuICAgKiBodHRwOi8vcGxhbmV0bWF0aC5vcmcvc2l0ZXMvZGVmYXVsdC9maWxlcy90ZXhwZGYvMzk3NDUucGRmXG4gICAqXG4gICAqIFRoaXMgYWxnb3JpdGhtIGhhcHBlbnMgdG8gbWF0Y2ggdGhlIGFsZ29yaXRobSB1c2VkIGJ5IENBU3ByaW5nQW5pbWF0aW9uLFxuICAgKiBhIFF1YXJ0ekNvcmUgKGlPUykgQVBJIHRoYXQgY3JlYXRlcyBzcHJpbmcgYW5pbWF0aW9ucy5cbiAgICovXG4gIG9uVXBkYXRlKCk6IHZvaWQge1xuICAgIC8vIElmIGZvciBzb21lIHJlYXNvbiB3ZSBsb3N0IGEgbG90IG9mIGZyYW1lcyAoZS5nLiBwcm9jZXNzIGxhcmdlIHBheWxvYWQgb3JcbiAgICAvLyBzdG9wcGVkIGluIHRoZSBkZWJ1Z2dlciksIHdlIG9ubHkgYWR2YW5jZSBieSA0IGZyYW1lcyB3b3J0aCBvZlxuICAgIC8vIGNvbXB1dGF0aW9uIGFuZCB3aWxsIGNvbnRpbnVlIG9uIHRoZSBuZXh0IGZyYW1lLiBJdCdzIGJldHRlciB0byBoYXZlIGl0XG4gICAgLy8gcnVubmluZyBhdCBmYXN0ZXIgc3BlZWQgdGhhbiBqdW1waW5nIHRvIHRoZSBlbmQuXG4gICAgY29uc3QgTUFYX1NURVBTID0gNjQ7XG4gICAgbGV0IG5vdyA9IERhdGUubm93KCk7XG4gICAgaWYgKG5vdyA+IHRoaXMuX2xhc3RUaW1lICsgTUFYX1NURVBTKSB7XG4gICAgICBub3cgPSB0aGlzLl9sYXN0VGltZSArIE1BWF9TVEVQUztcbiAgICB9XG5cbiAgICBjb25zdCBkZWx0YVRpbWUgPSAobm93IC0gdGhpcy5fbGFzdFRpbWUpIC8gMTAwMDtcbiAgICB0aGlzLl9mcmFtZVRpbWUgKz0gZGVsdGFUaW1lO1xuXG4gICAgY29uc3QgYzogbnVtYmVyID0gdGhpcy5fZGFtcGluZztcbiAgICBjb25zdCBtOiBudW1iZXIgPSB0aGlzLl9tYXNzO1xuICAgIGNvbnN0IGs6IG51bWJlciA9IHRoaXMuX3N0aWZmbmVzcztcbiAgICBjb25zdCB2MDogbnVtYmVyID0gLXRoaXMuX2luaXRpYWxWZWxvY2l0eTtcblxuICAgIGNvbnN0IHpldGEgPSBjIC8gKDIgKiBNYXRoLnNxcnQoayAqIG0pKTsgLy8gZGFtcGluZyByYXRpb1xuICAgIGNvbnN0IG9tZWdhMCA9IE1hdGguc3FydChrIC8gbSk7IC8vIHVuZGFtcGVkIGFuZ3VsYXIgZnJlcXVlbmN5IG9mIHRoZSBvc2NpbGxhdG9yIChyYWQvbXMpXG4gICAgY29uc3Qgb21lZ2ExID0gb21lZ2EwICogTWF0aC5zcXJ0KDEuMCAtIHpldGEgKiB6ZXRhKTsgLy8gZXhwb25lbnRpYWwgZGVjYXlcbiAgICBjb25zdCB4MCA9IHRoaXMuX3RvVmFsdWUgLSB0aGlzLl9zdGFydFBvc2l0aW9uOyAvLyBjYWxjdWxhdGUgdGhlIG9zY2lsbGF0aW9uIGZyb20geDAgPSAxIHRvIHggPSAwXG5cbiAgICBsZXQgcG9zaXRpb24gPSAwLjA7XG4gICAgbGV0IHZlbG9jaXR5ID0gMC4wO1xuICAgIGNvbnN0IHQgPSB0aGlzLl9mcmFtZVRpbWU7XG4gICAgaWYgKHpldGEgPCAxKSB7XG4gICAgICAvLyBVbmRlciBkYW1wZWRcbiAgICAgIGNvbnN0IGVudmVsb3BlID0gTWF0aC5leHAoLXpldGEgKiBvbWVnYTAgKiB0KTtcbiAgICAgIHBvc2l0aW9uID1cbiAgICAgICAgdGhpcy5fdG9WYWx1ZSAtXG4gICAgICAgIGVudmVsb3BlICpcbiAgICAgICAgICAoKHYwICsgemV0YSAqIG9tZWdhMCAqIHgwKSAvIG9tZWdhMSAqIE1hdGguc2luKG9tZWdhMSAqIHQpICtcbiAgICAgICAgICAgIHgwICogTWF0aC5jb3Mob21lZ2ExICogdCkpO1xuICAgICAgLy8gVGhpcyBsb29rcyBjcmF6eSAtLSBpdCdzIGFjdHVhbGx5IGp1c3QgdGhlIGRlcml2YXRpdmUgb2YgdGhlXG4gICAgICAvLyBvc2NpbGxhdGlvbiBmdW5jdGlvblxuICAgICAgdmVsb2NpdHkgPVxuICAgICAgICB6ZXRhICpcbiAgICAgICAgICBvbWVnYTAgKlxuICAgICAgICAgIGVudmVsb3BlICpcbiAgICAgICAgICAoTWF0aC5zaW4ob21lZ2ExICogdCkgKiAodjAgKyB6ZXRhICogb21lZ2EwICogeDApIC8gb21lZ2ExICtcbiAgICAgICAgICAgIHgwICogTWF0aC5jb3Mob21lZ2ExICogdCkpIC1cbiAgICAgICAgZW52ZWxvcGUgKlxuICAgICAgICAgIChNYXRoLmNvcyhvbWVnYTEgKiB0KSAqICh2MCArIHpldGEgKiBvbWVnYTAgKiB4MCkgLVxuICAgICAgICAgICAgb21lZ2ExICogeDAgKiBNYXRoLnNpbihvbWVnYTEgKiB0KSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIENyaXRpY2FsbHkgZGFtcGVkXG4gICAgICBjb25zdCBlbnZlbG9wZSA9IE1hdGguZXhwKC1vbWVnYTAgKiB0KTtcbiAgICAgIHBvc2l0aW9uID0gdGhpcy5fdG9WYWx1ZSAtIGVudmVsb3BlICogKHgwICsgKHYwICsgb21lZ2EwICogeDApICogdCk7XG4gICAgICB2ZWxvY2l0eSA9XG4gICAgICAgIGVudmVsb3BlICogKHYwICogKHQgKiBvbWVnYTAgLSAxKSArIHQgKiB4MCAqIChvbWVnYTAgKiBvbWVnYTApKTtcbiAgICB9XG5cbiAgICB0aGlzLl9sYXN0VGltZSA9IG5vdztcbiAgICB0aGlzLl9sYXN0UG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICB0aGlzLl9sYXN0VmVsb2NpdHkgPSB2ZWxvY2l0eTtcblxuICAgIHRoaXMuX29uVXBkYXRlKHBvc2l0aW9uKTtcbiAgICBpZiAoIXRoaXMuX19hY3RpdmUpIHtcbiAgICAgIC8vIGEgbGlzdGVuZXIgbWlnaHQgaGF2ZSBzdG9wcGVkIHVzIGluIF9vblVwZGF0ZVxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIENvbmRpdGlvbnMgZm9yIHN0b3BwaW5nIHRoZSBzcHJpbmcgYW5pbWF0aW9uXG4gICAgbGV0IGlzT3ZlcnNob290aW5nID0gZmFsc2U7XG4gICAgaWYgKHRoaXMuX292ZXJzaG9vdENsYW1waW5nICYmIHRoaXMuX3N0aWZmbmVzcyAhPT0gMCkge1xuICAgICAgaWYgKHRoaXMuX3N0YXJ0UG9zaXRpb24gPCB0aGlzLl90b1ZhbHVlKSB7XG4gICAgICAgIGlzT3ZlcnNob290aW5nID0gcG9zaXRpb24gPiB0aGlzLl90b1ZhbHVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaXNPdmVyc2hvb3RpbmcgPSBwb3NpdGlvbiA8IHRoaXMuX3RvVmFsdWU7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGlzVmVsb2NpdHkgPSBNYXRoLmFicyh2ZWxvY2l0eSkgPD0gdGhpcy5fcmVzdFNwZWVkVGhyZXNob2xkO1xuICAgIGxldCBpc0Rpc3BsYWNlbWVudCA9IHRydWU7XG4gICAgaWYgKHRoaXMuX3N0aWZmbmVzcyAhPT0gMCkge1xuICAgICAgaXNEaXNwbGFjZW1lbnQgPVxuICAgICAgICBNYXRoLmFicyh0aGlzLl90b1ZhbHVlIC0gcG9zaXRpb24pIDw9IHRoaXMuX3Jlc3REaXNwbGFjZW1lbnRUaHJlc2hvbGQ7XG4gICAgfVxuXG4gICAgaWYgKGlzT3ZlcnNob290aW5nIHx8IChpc1ZlbG9jaXR5ICYmIGlzRGlzcGxhY2VtZW50KSkge1xuICAgICAgaWYgKHRoaXMuX3N0aWZmbmVzcyAhPT0gMCkge1xuICAgICAgICAvLyBFbnN1cmUgdGhhdCB3ZSBlbmQgdXAgd2l0aCBhIHJvdW5kIHZhbHVlXG4gICAgICAgIHRoaXMuX2xhc3RQb3NpdGlvbiA9IHRoaXMuX3RvVmFsdWU7XG4gICAgICAgIHRoaXMuX2xhc3RWZWxvY2l0eSA9IDA7XG4gICAgICAgIHRoaXMuX29uVXBkYXRlKHRoaXMuX3RvVmFsdWUpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl9fZGVib3VuY2VkT25FbmQoe2ZpbmlzaGVkOiB0cnVlfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuX2FuaW1hdGlvbkZyYW1lID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMub25VcGRhdGUuYmluZCh0aGlzKSk7XG4gIH1cblxuICBzdG9wKCk6IHZvaWQge1xuICAgIHN1cGVyLnN0b3AoKTtcbiAgICB0aGlzLl9fYWN0aXZlID0gZmFsc2U7XG4gICAgY2xlYXJUaW1lb3V0KHRoaXMuX3RpbWVvdXQpO1xuICAgIGdsb2JhbC5jYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLl9hbmltYXRpb25GcmFtZSk7XG4gICAgdGhpcy5fX2RlYm91bmNlZE9uRW5kKHtmaW5pc2hlZDogZmFsc2V9KTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFNwcmluZ0FuaW1hdGlvbjtcbiJdfQ==