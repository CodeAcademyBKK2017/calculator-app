a8d7c75d2369d0c40a6cd5e72a1709ff











'use strict';

var invariant=require('fbjs/lib/invariant');














var TRACE_TAG_REACT_APPS=1<<17;
var TRACE_TAG_JSC_CALLS=1<<27;

var _enabled=false;
var _asyncCookie=0;
var _markStack=[];
var _markStackIndex=-1;
var _canInstallReactHook=false;
var _useFiber=false;



var REACT_MARKER='\u269B';
var userTimingPolyfill=__DEV__?{
mark:function mark(markName){
if(_enabled){
_markStackIndex++;
_markStack[_markStackIndex]=markName;
var systraceLabel=markName;


if(markName[0]===REACT_MARKER){


var indexOfId=markName.lastIndexOf(' (#');
var cutoffIndex=indexOfId!==-1?indexOfId:markName.length;

systraceLabel=markName.slice(2,cutoffIndex);
}
Systrace.beginEvent(systraceLabel);
}
},
measure:function measure(measureName,startMark,endMark){
if(_enabled){
invariant(
typeof measureName==='string'&&
typeof startMark==='string'&&
typeof endMark==='undefined',
'Only performance.measure(string, string) overload is supported.');

var topMark=_markStack[_markStackIndex];
invariant(
startMark===topMark,
'There was a mismatching performance.measure() call. '+
'Expected "%s" but got "%s."',
topMark,
startMark);

_markStackIndex--;


Systrace.endEvent();
}
},
clearMarks:function clearMarks(markName){
if(_enabled){
if(_markStackIndex===-1){
return;
}
if(markName===_markStack[_markStackIndex]){


if(userTimingPolyfill!=null){
userTimingPolyfill.measure(markName,markName);
}
}
}
},
clearMeasures:function clearMeasures(){


}}:
null;


var reactDebugToolHook=__DEV__?{
onBeforeMountComponent:function onBeforeMountComponent(debugID){
var ReactComponentTreeHook=require('ReactGlobalSharedState').ReactComponentTreeHook;
var displayName=ReactComponentTreeHook.getDisplayName(debugID);
Systrace.beginEvent('ReactReconciler.mountComponent('+displayName+')');
},
onMountComponent:function onMountComponent(debugID){
Systrace.endEvent();
},
onBeforeUpdateComponent:function onBeforeUpdateComponent(debugID){
var ReactComponentTreeHook=require('ReactGlobalSharedState').ReactComponentTreeHook;
var displayName=ReactComponentTreeHook.getDisplayName(debugID);
Systrace.beginEvent('ReactReconciler.updateComponent('+displayName+')');
},
onUpdateComponent:function onUpdateComponent(debugID){
Systrace.endEvent();
},
onBeforeUnmountComponent:function onBeforeUnmountComponent(debugID){
var ReactComponentTreeHook=require('ReactGlobalSharedState').ReactComponentTreeHook;
var displayName=ReactComponentTreeHook.getDisplayName(debugID);
Systrace.beginEvent('ReactReconciler.unmountComponent('+displayName+')');
},
onUnmountComponent:function onUnmountComponent(debugID){
Systrace.endEvent();
},
onBeginLifeCycleTimer:function onBeginLifeCycleTimer(debugID,timerType){
var ReactComponentTreeHook=require('ReactGlobalSharedState').ReactComponentTreeHook;
var displayName=ReactComponentTreeHook.getDisplayName(debugID);
Systrace.beginEvent(displayName+'.'+timerType+'()');
},
onEndLifeCycleTimer:function onEndLifeCycleTimer(debugID,timerType){
Systrace.endEvent();
}}:
null;

var Systrace={
installReactHook:function installReactHook(useFiber){
if(_enabled){
if(__DEV__){
if(useFiber){
global.performance=userTimingPolyfill;
}else{
require('ReactDebugTool').addHook(reactDebugToolHook);
}
}
}
_useFiber=useFiber;
_canInstallReactHook=true;
},

setEnabled:function setEnabled(enabled){
if(_enabled!==enabled){
if(__DEV__){
if(enabled){
global.nativeTraceBeginLegacy&&global.nativeTraceBeginLegacy(TRACE_TAG_JSC_CALLS);
}else{
global.nativeTraceEndLegacy&&global.nativeTraceEndLegacy(TRACE_TAG_JSC_CALLS);
}
if(_canInstallReactHook){
if(_useFiber){
global.performance=enabled?userTimingPolyfill:undefined;
}else{
var ReactDebugTool=require('ReactDebugTool');
if(enabled){
ReactDebugTool.addHook(reactDebugToolHook);
}else{
ReactDebugTool.removeHook(reactDebugToolHook);
}
}
}
}
_enabled=enabled;
}
},

isEnabled:function isEnabled(){
return _enabled;
},




beginEvent:function beginEvent(profileName,args){
if(_enabled){
profileName=typeof profileName==='function'?
profileName():profileName;
global.nativeTraceBeginSection(TRACE_TAG_REACT_APPS,profileName,args);
}
},

endEvent:function endEvent(){
if(_enabled){
global.nativeTraceEndSection(TRACE_TAG_REACT_APPS);
}
},






beginAsyncEvent:function beginAsyncEvent(profileName){
var cookie=_asyncCookie;
if(_enabled){
_asyncCookie++;
profileName=typeof profileName==='function'?
profileName():profileName;
global.nativeTraceBeginAsyncSection(TRACE_TAG_REACT_APPS,profileName,cookie,0);
}
return cookie;
},

endAsyncEvent:function endAsyncEvent(profileName,cookie){
if(_enabled){
profileName=typeof profileName==='function'?
profileName():profileName;
global.nativeTraceEndAsyncSection(TRACE_TAG_REACT_APPS,profileName,cookie,0);
}
},




counterEvent:function counterEvent(profileName,value){
if(_enabled){
profileName=typeof profileName==='function'?
profileName():profileName;
global.nativeTraceCounter&&
global.nativeTraceCounter(TRACE_TAG_REACT_APPS,profileName,value);
}
},





attachToRelayProfiler:function attachToRelayProfiler(relayProfiler){
relayProfiler.attachProfileHandler('*',function(name){
var cookie=Systrace.beginAsyncEvent(name);
return function(){
Systrace.endAsyncEvent(name,cookie);
};
});

relayProfiler.attachAggregateHandler('*',function(name,callback){
Systrace.beginEvent(name);
callback();
Systrace.endEvent();
});
},



swizzleJSON:function swizzleJSON(){
Systrace.measureMethods(JSON,'JSON',[
'parse',
'stringify']);

},









measureMethods:function measureMethods(object,objectName,methodNames){
if(!__DEV__){
return;
}

methodNames.forEach(function(methodName){
object[methodName]=Systrace.measure(
objectName,
methodName,
object[methodName]);

});
},










measure:function measure(objName,fnName,func){
if(!__DEV__){
return func;
}

var profileName=objName+'.'+fnName;
return function(){
if(!_enabled){
return func.apply(this,arguments);
}

Systrace.beginEvent(profileName);
var ret=func.apply(this,arguments);
Systrace.endEvent();
return ret;
};
}};


if(__DEV__){




require.Systrace=Systrace;
}

module.exports=Systrace;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlN5c3RyYWNlLmpzIl0sIm5hbWVzIjpbImludmFyaWFudCIsInJlcXVpcmUiLCJUUkFDRV9UQUdfUkVBQ1RfQVBQUyIsIlRSQUNFX1RBR19KU0NfQ0FMTFMiLCJfZW5hYmxlZCIsIl9hc3luY0Nvb2tpZSIsIl9tYXJrU3RhY2siLCJfbWFya1N0YWNrSW5kZXgiLCJfY2FuSW5zdGFsbFJlYWN0SG9vayIsIl91c2VGaWJlciIsIlJFQUNUX01BUktFUiIsInVzZXJUaW1pbmdQb2x5ZmlsbCIsIl9fREVWX18iLCJtYXJrIiwibWFya05hbWUiLCJzeXN0cmFjZUxhYmVsIiwiaW5kZXhPZklkIiwibGFzdEluZGV4T2YiLCJjdXRvZmZJbmRleCIsImxlbmd0aCIsInNsaWNlIiwiU3lzdHJhY2UiLCJiZWdpbkV2ZW50IiwibWVhc3VyZSIsIm1lYXN1cmVOYW1lIiwic3RhcnRNYXJrIiwiZW5kTWFyayIsInRvcE1hcmsiLCJlbmRFdmVudCIsImNsZWFyTWFya3MiLCJjbGVhck1lYXN1cmVzIiwicmVhY3REZWJ1Z1Rvb2xIb29rIiwib25CZWZvcmVNb3VudENvbXBvbmVudCIsImRlYnVnSUQiLCJSZWFjdENvbXBvbmVudFRyZWVIb29rIiwiZGlzcGxheU5hbWUiLCJnZXREaXNwbGF5TmFtZSIsIm9uTW91bnRDb21wb25lbnQiLCJvbkJlZm9yZVVwZGF0ZUNvbXBvbmVudCIsIm9uVXBkYXRlQ29tcG9uZW50Iiwib25CZWZvcmVVbm1vdW50Q29tcG9uZW50Iiwib25Vbm1vdW50Q29tcG9uZW50Iiwib25CZWdpbkxpZmVDeWNsZVRpbWVyIiwidGltZXJUeXBlIiwib25FbmRMaWZlQ3ljbGVUaW1lciIsImluc3RhbGxSZWFjdEhvb2siLCJ1c2VGaWJlciIsImdsb2JhbCIsInBlcmZvcm1hbmNlIiwiYWRkSG9vayIsInNldEVuYWJsZWQiLCJlbmFibGVkIiwibmF0aXZlVHJhY2VCZWdpbkxlZ2FjeSIsIm5hdGl2ZVRyYWNlRW5kTGVnYWN5IiwidW5kZWZpbmVkIiwiUmVhY3REZWJ1Z1Rvb2wiLCJyZW1vdmVIb29rIiwiaXNFbmFibGVkIiwicHJvZmlsZU5hbWUiLCJhcmdzIiwibmF0aXZlVHJhY2VCZWdpblNlY3Rpb24iLCJuYXRpdmVUcmFjZUVuZFNlY3Rpb24iLCJiZWdpbkFzeW5jRXZlbnQiLCJjb29raWUiLCJuYXRpdmVUcmFjZUJlZ2luQXN5bmNTZWN0aW9uIiwiZW5kQXN5bmNFdmVudCIsIm5hdGl2ZVRyYWNlRW5kQXN5bmNTZWN0aW9uIiwiY291bnRlckV2ZW50IiwidmFsdWUiLCJuYXRpdmVUcmFjZUNvdW50ZXIiLCJhdHRhY2hUb1JlbGF5UHJvZmlsZXIiLCJyZWxheVByb2ZpbGVyIiwiYXR0YWNoUHJvZmlsZUhhbmRsZXIiLCJuYW1lIiwiYXR0YWNoQWdncmVnYXRlSGFuZGxlciIsImNhbGxiYWNrIiwic3dpenpsZUpTT04iLCJtZWFzdXJlTWV0aG9kcyIsIkpTT04iLCJvYmplY3QiLCJvYmplY3ROYW1lIiwibWV0aG9kTmFtZXMiLCJmb3JFYWNoIiwibWV0aG9kTmFtZSIsIm9iak5hbWUiLCJmbk5hbWUiLCJmdW5jIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJyZXQiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQVdBOztBQUVBLEdBQU1BLFdBQVlDLFFBQVEsb0JBQVIsQ0FBbEI7Ozs7Ozs7Ozs7Ozs7OztBQWVBLEdBQU1DLHNCQUF1QixHQUFLLEVBQWxDO0FBQ0EsR0FBTUMscUJBQXNCLEdBQUssRUFBakM7O0FBRUEsR0FBSUMsVUFBVyxLQUFmO0FBQ0EsR0FBSUMsY0FBZSxDQUFuQjtBQUNBLEdBQU1DLFlBQWEsRUFBbkI7QUFDQSxHQUFJQyxpQkFBa0IsQ0FBQyxDQUF2QjtBQUNBLEdBQUlDLHNCQUF1QixLQUEzQjtBQUNBLEdBQUlDLFdBQVksS0FBaEI7Ozs7QUFJQSxHQUFNQyxjQUFlLFFBQXJCO0FBQ0EsR0FBTUMsb0JBQXFCQyxRQUFVO0FBQ25DQyxJQURtQyxlQUM5QkMsUUFEOEIsQ0FDWjtBQUNyQixHQUFJVixRQUFK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WixDQUFvQixvQkFBYztBQUNoQ0gsT0FBT0ksVUFBUCxFQUFxQjlELFNBQVNFLE9BQVQ7QUFDbkJ5RCxVQURtQjtBQUVuQkcsVUFGbUI7QUFHbkJKLE9BQU9JLFVBQVAsQ0FIbUIsQ0FBckI7O0FBS0QsQ0FORDtBQU9ELENBakplOzs7Ozs7Ozs7OztBQTRKaEI1RCxPQTVKZ0Isa0JBNEpSNkQsT0E1SlEsQ0E0SlNDLE1BNUpULENBNEp5QkMsSUE1SnpCLENBNEp5QztBQUN2RCxHQUFJLENBQUMxRSxPQUFMLENBQWM7QUFDWixNQUFPMEUsS0FBUDtBQUNEOztBQUVELEdBQU01QixhQUFpQjBCLE9BQWpCLEtBQTRCQyxNQUFsQztBQUNBLE1BQU8sV0FBVztBQUNoQixHQUFJLENBQUNqRixRQUFMLENBQWU7QUFDYixNQUFPa0YsTUFBS0MsS0FBTCxDQUFXLElBQVgsQ0FBaUJDLFNBQWpCLENBQVA7QUFDRDs7QUFFRG5FLFNBQVNDLFVBQVQsQ0FBb0JvQyxXQUFwQjtBQUNBLEdBQU0rQixLQUFNSCxLQUFLQyxLQUFMLENBQVcsSUFBWCxDQUFpQkMsU0FBakIsQ0FBWjtBQUNBbkUsU0FBU08sUUFBVDtBQUNBLE1BQU82RCxJQUFQO0FBQ0QsQ0FURDtBQVVELENBNUtlLENBQWpCOzs7QUErS0EsR0FBSTdFLE9BQUosQ0FBYTs7Ozs7QUFLVlgsT0FBRCxDQUFlb0IsUUFBZixDQUEwQkEsUUFBMUI7QUFDRDs7QUFFRHFFLE9BQU9DLE9BQVAsQ0FBaUJ0RSxRQUFqQiIsImZpbGUiOiJTeXN0cmFjZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cbiAqXG4gKiBAcHJvdmlkZXNNb2R1bGUgU3lzdHJhY2VcbiAqIEBmbG93XG4gKi9cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnZmJqcy9saWIvaW52YXJpYW50Jyk7XG5cbnR5cGUgUmVsYXlQcm9maWxlciA9IHtcbiAgYXR0YWNoUHJvZmlsZUhhbmRsZXIoXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIGhhbmRsZXI6IChuYW1lOiBzdHJpbmcsIHN0YXRlPzogYW55KSA9PiAoKSA9PiB2b2lkXG4gICk6IHZvaWQsXG5cbiAgYXR0YWNoQWdncmVnYXRlSGFuZGxlcihcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgaGFuZGxlcjogKG5hbWU6IHN0cmluZywgY2FsbGJhY2s6ICgpID0+IHZvaWQpID0+IHZvaWRcbiAgKTogdm9pZCxcbn07XG5cbi8qIGVzbGludCBuby1iaXR3aXNlOiAwICovXG5jb25zdCBUUkFDRV9UQUdfUkVBQ1RfQVBQUyA9IDEgPDwgMTc7XG5jb25zdCBUUkFDRV9UQUdfSlNDX0NBTExTID0gMSA8PCAyNztcblxubGV0IF9lbmFibGVkID0gZmFsc2U7XG5sZXQgX2FzeW5jQ29va2llID0gMDtcbmNvbnN0IF9tYXJrU3RhY2sgPSBbXTtcbmxldCBfbWFya1N0YWNrSW5kZXggPSAtMTtcbmxldCBfY2FuSW5zdGFsbFJlYWN0SG9vayA9IGZhbHNlO1xubGV0IF91c2VGaWJlciA9IGZhbHNlO1xuXG4vLyBJbXBsZW1lbnRzIGEgc3Vic2V0IG9mIFVzZXIgVGltaW5nIEFQSSBuZWNlc3NhcnkgZm9yIFJlYWN0IG1lYXN1cmVtZW50cy5cbi8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9Vc2VyX1RpbWluZ19BUElcbmNvbnN0IFJFQUNUX01BUktFUiA9ICdcXHUyNjlCJztcbmNvbnN0IHVzZXJUaW1pbmdQb2x5ZmlsbCA9IF9fREVWX18gPyB7XG4gIG1hcmsobWFya05hbWU6IHN0cmluZykge1xuICAgIGlmIChfZW5hYmxlZCkge1xuICAgICAgX21hcmtTdGFja0luZGV4Kys7XG4gICAgICBfbWFya1N0YWNrW19tYXJrU3RhY2tJbmRleF0gPSBtYXJrTmFtZTtcbiAgICAgIGxldCBzeXN0cmFjZUxhYmVsID0gbWFya05hbWU7XG4gICAgICAvLyBTaW5jZSBwZXJmIG1lYXN1cmVtZW50cyBhcmUgYSBzaGFyZWQgbmFtZXNwYWNlIGluIFVzZXIgVGltaW5nIEFQSSxcbiAgICAgIC8vIHdlIHByZWZpeCBhbGwgUmVhY3QgcmVzdWx0cyB3aXRoIGEgUmVhY3QgZW1vamkuXG4gICAgICBpZiAobWFya05hbWVbMF0gPT09IFJFQUNUX01BUktFUikge1xuICAgICAgICAvLyBUaGlzIGlzIGNvbWluZyBmcm9tIFJlYWN0LlxuICAgICAgICAvLyBSZW1vdmluZyBjb21wb25lbnQgSURzIGtlZXBzIHRyYWNlIGNvbG9ycyBzdGFibGUuXG4gICAgICAgIGNvbnN0IGluZGV4T2ZJZCA9IG1hcmtOYW1lLmxhc3RJbmRleE9mKCcgKCMnKTtcbiAgICAgICAgY29uc3QgY3V0b2ZmSW5kZXggPSBpbmRleE9mSWQgIT09IC0xID8gaW5kZXhPZklkIDogbWFya05hbWUubGVuZ3RoO1xuICAgICAgICAvLyBBbHNvIGN1dCBvZmYgdGhlIGVtb2ppIGJlY2F1c2UgaXQgYnJlYWtzIFN5c3RyYWNlXG4gICAgICAgIHN5c3RyYWNlTGFiZWwgPSBtYXJrTmFtZS5zbGljZSgyLCBjdXRvZmZJbmRleCk7XG4gICAgICB9XG4gICAgICBTeXN0cmFjZS5iZWdpbkV2ZW50KHN5c3RyYWNlTGFiZWwpO1xuICAgIH1cbiAgfSxcbiAgbWVhc3VyZShtZWFzdXJlTmFtZTogc3RyaW5nLCBzdGFydE1hcms6ID9zdHJpbmcsIGVuZE1hcms6ID9zdHJpbmcpIHtcbiAgICBpZiAoX2VuYWJsZWQpIHtcbiAgICAgIGludmFyaWFudChcbiAgICAgICAgdHlwZW9mIG1lYXN1cmVOYW1lID09PSAnc3RyaW5nJyAmJlxuICAgICAgICB0eXBlb2Ygc3RhcnRNYXJrID09PSAnc3RyaW5nJyAmJlxuICAgICAgICB0eXBlb2YgZW5kTWFyayA9PT0gJ3VuZGVmaW5lZCcsXG4gICAgICAgICdPbmx5IHBlcmZvcm1hbmNlLm1lYXN1cmUoc3RyaW5nLCBzdHJpbmcpIG92ZXJsb2FkIGlzIHN1cHBvcnRlZC4nXG4gICAgICApO1xuICAgICAgY29uc3QgdG9wTWFyayA9IF9tYXJrU3RhY2tbX21hcmtTdGFja0luZGV4XTtcbiAgICAgIGludmFyaWFudChcbiAgICAgICAgc3RhcnRNYXJrID09PSB0b3BNYXJrLFxuICAgICAgICAnVGhlcmUgd2FzIGEgbWlzbWF0Y2hpbmcgcGVyZm9ybWFuY2UubWVhc3VyZSgpIGNhbGwuICcgK1xuICAgICAgICAnRXhwZWN0ZWQgXCIlc1wiIGJ1dCBnb3QgXCIlcy5cIicsXG4gICAgICAgIHRvcE1hcmssXG4gICAgICAgIHN0YXJ0TWFyayxcbiAgICAgICk7XG4gICAgICBfbWFya1N0YWNrSW5kZXgtLTtcbiAgICAgIC8vIFdlIGNhbid0IHVzZSBtb3JlIGRlc2NyaXB0aXZlIG1lYXN1cmVOYW1lIGJlY2F1c2UgU3lzdHJhY2UgZG9lc24ndFxuICAgICAgLy8gbGV0IHVzIGVkaXQgbGFiZWxzIHBvc3QgZmFjdHVtLlxuICAgICAgU3lzdHJhY2UuZW5kRXZlbnQoKTtcbiAgICB9XG4gIH0sXG4gIGNsZWFyTWFya3MobWFya05hbWU6IHN0cmluZykge1xuICAgIGlmIChfZW5hYmxlZCkge1xuICAgICAgaWYgKF9tYXJrU3RhY2tJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKG1hcmtOYW1lID09PSBfbWFya1N0YWNrW19tYXJrU3RhY2tJbmRleF0pIHtcbiAgICAgICAgLy8gUmVhY3QgdXNlcyB0aGlzIGZvciBcImNhbmNlbGxpbmdcIiBzdGFydGVkIG1lYXN1cmVtZW50cy5cbiAgICAgICAgLy8gU3lzdHJhY2UgZG9lc24ndCBzdXBwb3J0IGRlbGV0aW5nIG1lYXN1cmVtZW50cywgc28gd2UganVzdCBzdG9wIHRoZW0uXG4gICAgICAgIGlmICh1c2VyVGltaW5nUG9seWZpbGwgIT0gbnVsbCkge1xuICAgICAgICAgIHVzZXJUaW1pbmdQb2x5ZmlsbC5tZWFzdXJlKG1hcmtOYW1lLCBtYXJrTmFtZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGNsZWFyTWVhc3VyZXMoKSB7XG4gICAgLy8gUmVhY3QgY2FsbHMgdGhpcyB0byBhdm9pZCBtZW1vcnkgbGVha3MgaW4gYnJvd3NlcnMsIGJ1dCB3ZSBkb24ndCBrZWVwXG4gICAgLy8gbWVhc3VyZW1lbnRzIGFueXdheS5cbiAgfSxcbn0gOiBudWxsO1xuXG4vLyBBIGhvb2sgdG8gZ2V0IFJlYWN0IFN0YWNrIG1hcmtlcnMgaW4gU3lzdHJhY2UuXG5jb25zdCByZWFjdERlYnVnVG9vbEhvb2sgPSBfX0RFVl9fID8ge1xuICBvbkJlZm9yZU1vdW50Q29tcG9uZW50KGRlYnVnSUQpIHtcbiAgICBjb25zdCBSZWFjdENvbXBvbmVudFRyZWVIb29rID0gcmVxdWlyZSgnUmVhY3RHbG9iYWxTaGFyZWRTdGF0ZScpLlJlYWN0Q29tcG9uZW50VHJlZUhvb2s7XG4gICAgY29uc3QgZGlzcGxheU5hbWUgPSBSZWFjdENvbXBvbmVudFRyZWVIb29rLmdldERpc3BsYXlOYW1lKGRlYnVnSUQpO1xuICAgIFN5c3RyYWNlLmJlZ2luRXZlbnQoYFJlYWN0UmVjb25jaWxlci5tb3VudENvbXBvbmVudCgke2Rpc3BsYXlOYW1lfSlgKTtcbiAgfSxcbiAgb25Nb3VudENvbXBvbmVudChkZWJ1Z0lEKSB7XG4gICAgU3lzdHJhY2UuZW5kRXZlbnQoKTtcbiAgfSxcbiAgb25CZWZvcmVVcGRhdGVDb21wb25lbnQoZGVidWdJRCkge1xuICAgIGNvbnN0IFJlYWN0Q29tcG9uZW50VHJlZUhvb2sgPSByZXF1aXJlKCdSZWFjdEdsb2JhbFNoYXJlZFN0YXRlJykuUmVhY3RDb21wb25lbnRUcmVlSG9vaztcbiAgICBjb25zdCBkaXNwbGF5TmFtZSA9IFJlYWN0Q29tcG9uZW50VHJlZUhvb2suZ2V0RGlzcGxheU5hbWUoZGVidWdJRCk7XG4gICAgU3lzdHJhY2UuYmVnaW5FdmVudChgUmVhY3RSZWNvbmNpbGVyLnVwZGF0ZUNvbXBvbmVudCgke2Rpc3BsYXlOYW1lfSlgKTtcbiAgfSxcbiAgb25VcGRhdGVDb21wb25lbnQoZGVidWdJRCkge1xuICAgIFN5c3RyYWNlLmVuZEV2ZW50KCk7XG4gIH0sXG4gIG9uQmVmb3JlVW5tb3VudENvbXBvbmVudChkZWJ1Z0lEKSB7XG4gICAgY29uc3QgUmVhY3RDb21wb25lbnRUcmVlSG9vayA9IHJlcXVpcmUoJ1JlYWN0R2xvYmFsU2hhcmVkU3RhdGUnKS5SZWFjdENvbXBvbmVudFRyZWVIb29rO1xuICAgIGNvbnN0IGRpc3BsYXlOYW1lID0gUmVhY3RDb21wb25lbnRUcmVlSG9vay5nZXREaXNwbGF5TmFtZShkZWJ1Z0lEKTtcbiAgICBTeXN0cmFjZS5iZWdpbkV2ZW50KGBSZWFjdFJlY29uY2lsZXIudW5tb3VudENvbXBvbmVudCgke2Rpc3BsYXlOYW1lfSlgKTtcbiAgfSxcbiAgb25Vbm1vdW50Q29tcG9uZW50KGRlYnVnSUQpIHtcbiAgICBTeXN0cmFjZS5lbmRFdmVudCgpO1xuICB9LFxuICBvbkJlZ2luTGlmZUN5Y2xlVGltZXIoZGVidWdJRCwgdGltZXJUeXBlKSB7XG4gICAgY29uc3QgUmVhY3RDb21wb25lbnRUcmVlSG9vayA9IHJlcXVpcmUoJ1JlYWN0R2xvYmFsU2hhcmVkU3RhdGUnKS5SZWFjdENvbXBvbmVudFRyZWVIb29rO1xuICAgIGNvbnN0IGRpc3BsYXlOYW1lID0gUmVhY3RDb21wb25lbnRUcmVlSG9vay5nZXREaXNwbGF5TmFtZShkZWJ1Z0lEKTtcbiAgICBTeXN0cmFjZS5iZWdpbkV2ZW50KGAke2Rpc3BsYXlOYW1lfS4ke3RpbWVyVHlwZX0oKWApO1xuICB9LFxuICBvbkVuZExpZmVDeWNsZVRpbWVyKGRlYnVnSUQsIHRpbWVyVHlwZSkge1xuICAgIFN5c3RyYWNlLmVuZEV2ZW50KCk7XG4gIH0sXG59IDogbnVsbDtcblxuY29uc3QgU3lzdHJhY2UgPSB7XG4gIGluc3RhbGxSZWFjdEhvb2sodXNlRmliZXI6IGJvb2xlYW4pIHtcbiAgICBpZiAoX2VuYWJsZWQpIHtcbiAgICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICAgIGlmICh1c2VGaWJlcikge1xuICAgICAgICAgIGdsb2JhbC5wZXJmb3JtYW5jZSA9IHVzZXJUaW1pbmdQb2x5ZmlsbDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXF1aXJlKCdSZWFjdERlYnVnVG9vbCcpLmFkZEhvb2socmVhY3REZWJ1Z1Rvb2xIb29rKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBfdXNlRmliZXIgPSB1c2VGaWJlcjtcbiAgICBfY2FuSW5zdGFsbFJlYWN0SG9vayA9IHRydWU7XG4gIH0sXG5cbiAgc2V0RW5hYmxlZChlbmFibGVkOiBib29sZWFuKSB7XG4gICAgaWYgKF9lbmFibGVkICE9PSBlbmFibGVkKSB7XG4gICAgICBpZiAoX19ERVZfXykge1xuICAgICAgICBpZiAoZW5hYmxlZCkge1xuICAgICAgICAgIGdsb2JhbC5uYXRpdmVUcmFjZUJlZ2luTGVnYWN5ICYmIGdsb2JhbC5uYXRpdmVUcmFjZUJlZ2luTGVnYWN5KFRSQUNFX1RBR19KU0NfQ0FMTFMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGdsb2JhbC5uYXRpdmVUcmFjZUVuZExlZ2FjeSAmJiBnbG9iYWwubmF0aXZlVHJhY2VFbmRMZWdhY3koVFJBQ0VfVEFHX0pTQ19DQUxMUyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKF9jYW5JbnN0YWxsUmVhY3RIb29rKSB7XG4gICAgICAgICAgaWYgKF91c2VGaWJlcikge1xuICAgICAgICAgICAgZ2xvYmFsLnBlcmZvcm1hbmNlID0gZW5hYmxlZCA/IHVzZXJUaW1pbmdQb2x5ZmlsbCA6IHVuZGVmaW5lZDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgUmVhY3REZWJ1Z1Rvb2wgPSByZXF1aXJlKCdSZWFjdERlYnVnVG9vbCcpO1xuICAgICAgICAgICAgaWYgKGVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgUmVhY3REZWJ1Z1Rvb2wuYWRkSG9vayhyZWFjdERlYnVnVG9vbEhvb2spO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgUmVhY3REZWJ1Z1Rvb2wucmVtb3ZlSG9vayhyZWFjdERlYnVnVG9vbEhvb2spO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgX2VuYWJsZWQgPSBlbmFibGVkO1xuICAgIH1cbiAgfSxcblxuICBpc0VuYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIF9lbmFibGVkO1xuICB9LFxuXG4gIC8qKlxuICAgKiBiZWdpbkV2ZW50L2VuZEV2ZW50IGZvciBzdGFydGluZyBhbmQgdGhlbiBlbmRpbmcgYSBwcm9maWxlIHdpdGhpbiB0aGUgc2FtZSBjYWxsIHN0YWNrIGZyYW1lXG4gICoqL1xuICBiZWdpbkV2ZW50KHByb2ZpbGVOYW1lPzogYW55LCBhcmdzPzogYW55KSB7XG4gICAgaWYgKF9lbmFibGVkKSB7XG4gICAgICBwcm9maWxlTmFtZSA9IHR5cGVvZiBwcm9maWxlTmFtZSA9PT0gJ2Z1bmN0aW9uJyA/XG4gICAgICAgIHByb2ZpbGVOYW1lKCkgOiBwcm9maWxlTmFtZTtcbiAgICAgIGdsb2JhbC5uYXRpdmVUcmFjZUJlZ2luU2VjdGlvbihUUkFDRV9UQUdfUkVBQ1RfQVBQUywgcHJvZmlsZU5hbWUsIGFyZ3MpO1xuICAgIH1cbiAgfSxcblxuICBlbmRFdmVudCgpIHtcbiAgICBpZiAoX2VuYWJsZWQpIHtcbiAgICAgIGdsb2JhbC5uYXRpdmVUcmFjZUVuZFNlY3Rpb24oVFJBQ0VfVEFHX1JFQUNUX0FQUFMpO1xuICAgIH1cbiAgfSxcblxuICAvKipcbiAgICogYmVnaW5Bc3luY0V2ZW50L2VuZEFzeW5jRXZlbnQgZm9yIHN0YXJ0aW5nIGFuZCB0aGVuIGVuZGluZyBhIHByb2ZpbGUgd2hlcmUgdGhlIGVuZCBjYW4gZWl0aGVyXG4gICAqIG9jY3VyIG9uIGFub3RoZXIgdGhyZWFkIG9yIG91dCBvZiB0aGUgY3VycmVudCBzdGFjayBmcmFtZSwgZWcgYXdhaXRcbiAgICogdGhlIHJldHVybmVkIGNvb2tpZSB2YXJpYWJsZSBzaG91bGQgYmUgdXNlZCBhcyBpbnB1dCBpbnRvIHRoZSBlbmRBc3luY0V2ZW50IGNhbGwgdG8gZW5kIHRoZSBwcm9maWxlXG4gICoqL1xuICBiZWdpbkFzeW5jRXZlbnQocHJvZmlsZU5hbWU/OiBhbnkpOiBhbnkge1xuICAgIGNvbnN0IGNvb2tpZSA9IF9hc3luY0Nvb2tpZTtcbiAgICBpZiAoX2VuYWJsZWQpIHtcbiAgICAgIF9hc3luY0Nvb2tpZSsrO1xuICAgICAgcHJvZmlsZU5hbWUgPSB0eXBlb2YgcHJvZmlsZU5hbWUgPT09ICdmdW5jdGlvbicgP1xuICAgICAgICBwcm9maWxlTmFtZSgpIDogcHJvZmlsZU5hbWU7XG4gICAgICBnbG9iYWwubmF0aXZlVHJhY2VCZWdpbkFzeW5jU2VjdGlvbihUUkFDRV9UQUdfUkVBQ1RfQVBQUywgcHJvZmlsZU5hbWUsIGNvb2tpZSwgMCk7XG4gICAgfVxuICAgIHJldHVybiBjb29raWU7XG4gIH0sXG5cbiAgZW5kQXN5bmNFdmVudChwcm9maWxlTmFtZT86IGFueSwgY29va2llPzogYW55KSB7XG4gICAgaWYgKF9lbmFibGVkKSB7XG4gICAgICBwcm9maWxlTmFtZSA9IHR5cGVvZiBwcm9maWxlTmFtZSA9PT0gJ2Z1bmN0aW9uJyA/XG4gICAgICAgIHByb2ZpbGVOYW1lKCkgOiBwcm9maWxlTmFtZTtcbiAgICAgIGdsb2JhbC5uYXRpdmVUcmFjZUVuZEFzeW5jU2VjdGlvbihUUkFDRV9UQUdfUkVBQ1RfQVBQUywgcHJvZmlsZU5hbWUsIGNvb2tpZSwgMCk7XG4gICAgfVxuICB9LFxuXG4gIC8qKlxuICAgKiBjb3VudGVyRXZlbnQgcmVnaXN0ZXJzIHRoZSB2YWx1ZSB0byB0aGUgcHJvZmlsZU5hbWUgb24gdGhlIHN5c3RyYWNlIHRpbWVsaW5lXG4gICoqL1xuICBjb3VudGVyRXZlbnQocHJvZmlsZU5hbWU/OiBhbnksIHZhbHVlPzogYW55KSB7XG4gICAgaWYgKF9lbmFibGVkKSB7XG4gICAgICBwcm9maWxlTmFtZSA9IHR5cGVvZiBwcm9maWxlTmFtZSA9PT0gJ2Z1bmN0aW9uJyA/XG4gICAgICAgIHByb2ZpbGVOYW1lKCkgOiBwcm9maWxlTmFtZTtcbiAgICAgIGdsb2JhbC5uYXRpdmVUcmFjZUNvdW50ZXIgJiZcbiAgICAgICAgZ2xvYmFsLm5hdGl2ZVRyYWNlQ291bnRlcihUUkFDRV9UQUdfUkVBQ1RfQVBQUywgcHJvZmlsZU5hbWUsIHZhbHVlKTtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJlbGF5IHByb2ZpbGVzIHVzZSBhd2FpdCBjYWxscywgc28gbGlrZWx5IG9jY3VyIG91dCBvZiBjdXJyZW50IHN0YWNrIGZyYW1lXG4gICAqIHRoZXJlZm9yZSBhc3luYyB2YXJpYW50IG9mIHByb2ZpbGluZyBpcyB1c2VkXG4gICoqL1xuICBhdHRhY2hUb1JlbGF5UHJvZmlsZXIocmVsYXlQcm9maWxlcjogUmVsYXlQcm9maWxlcikge1xuICAgIHJlbGF5UHJvZmlsZXIuYXR0YWNoUHJvZmlsZUhhbmRsZXIoJyonLCAobmFtZSkgPT4ge1xuICAgICAgY29uc3QgY29va2llID0gU3lzdHJhY2UuYmVnaW5Bc3luY0V2ZW50KG5hbWUpO1xuICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgU3lzdHJhY2UuZW5kQXN5bmNFdmVudChuYW1lLCBjb29raWUpO1xuICAgICAgfTtcbiAgICB9KTtcblxuICAgIHJlbGF5UHJvZmlsZXIuYXR0YWNoQWdncmVnYXRlSGFuZGxlcignKicsIChuYW1lLCBjYWxsYmFjaykgPT4ge1xuICAgICAgU3lzdHJhY2UuYmVnaW5FdmVudChuYW1lKTtcbiAgICAgIGNhbGxiYWNrKCk7XG4gICAgICBTeXN0cmFjZS5lbmRFdmVudCgpO1xuICAgIH0pO1xuICB9LFxuXG4gIC8qIFRoaXMgaXMgbm90IGNhbGxlZCBieSBkZWZhdWx0IGR1ZSB0byBwZXJmIG92ZXJoZWFkIGJ1dCBpdCdzIHVzZWZ1bFxuICAgICBpZiB5b3Ugd2FudCB0byBmaW5kIHRyYWNlcyB3aGljaCBzcGVuZCB0b28gbXVjaCB0aW1lIGluIEpTT04uICovXG4gIHN3aXp6bGVKU09OKCkge1xuICAgIFN5c3RyYWNlLm1lYXN1cmVNZXRob2RzKEpTT04sICdKU09OJywgW1xuICAgICAgJ3BhcnNlJyxcbiAgICAgICdzdHJpbmdpZnknXG4gICAgXSk7XG4gIH0sXG5cbiAvKipcbiAgKiBNZWFzdXJlcyBtdWx0aXBsZSBtZXRob2RzIG9mIGEgY2xhc3MuIEZvciBleGFtcGxlLCB5b3UgY2FuIGRvOlxuICAqIFN5c3RyYWNlLm1lYXN1cmVNZXRob2RzKEpTT04sICdKU09OJywgWydwYXJzZScsICdzdHJpbmdpZnknXSk7XG4gICpcbiAgKiBAcGFyYW0gb2JqZWN0XG4gICogQHBhcmFtIG9iamVjdE5hbWVcbiAgKiBAcGFyYW0gbWV0aG9kTmFtZXMgTWFwIGZyb20gbWV0aG9kIG5hbWVzIHRvIG1ldGhvZCBkaXNwbGF5IG5hbWVzLlxuICAqL1xuIG1lYXN1cmVNZXRob2RzKG9iamVjdDogYW55LCBvYmplY3ROYW1lOiBzdHJpbmcsIG1ldGhvZE5hbWVzOiBBcnJheTxzdHJpbmc+KTogdm9pZCB7XG4gICBpZiAoIV9fREVWX18pIHtcbiAgICAgcmV0dXJuO1xuICAgfVxuXG4gICBtZXRob2ROYW1lcy5mb3JFYWNoKG1ldGhvZE5hbWUgPT4ge1xuICAgICBvYmplY3RbbWV0aG9kTmFtZV0gPSBTeXN0cmFjZS5tZWFzdXJlKFxuICAgICAgIG9iamVjdE5hbWUsXG4gICAgICAgbWV0aG9kTmFtZSxcbiAgICAgICBvYmplY3RbbWV0aG9kTmFtZV1cbiAgICAgKTtcbiAgIH0pO1xuIH0sXG5cbiAvKipcbiAgKiBSZXR1cm5zIGFuIHByb2ZpbGVkIHZlcnNpb24gb2YgdGhlIGlucHV0IGZ1bmN0aW9uLiBGb3IgZXhhbXBsZSwgeW91IGNhbjpcbiAgKiBKU09OLnBhcnNlID0gU3lzdHJhY2UubWVhc3VyZSgnSlNPTicsICdwYXJzZScsIEpTT04ucGFyc2UpO1xuICAqXG4gICogQHBhcmFtIG9iak5hbWVcbiAgKiBAcGFyYW0gZm5OYW1lXG4gICogQHBhcmFtIHtmdW5jdGlvbn0gZnVuY1xuICAqIEByZXR1cm4ge2Z1bmN0aW9ufSByZXBsYWNlbWVudCBmdW5jdGlvblxuICAqL1xuIG1lYXN1cmUob2JqTmFtZTogc3RyaW5nLCBmbk5hbWU6IHN0cmluZywgZnVuYzogYW55KTogYW55IHtcbiAgIGlmICghX19ERVZfXykge1xuICAgICByZXR1cm4gZnVuYztcbiAgIH1cblxuICAgY29uc3QgcHJvZmlsZU5hbWUgPSBgJHtvYmpOYW1lfS4ke2ZuTmFtZX1gO1xuICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICBpZiAoIV9lbmFibGVkKSB7XG4gICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgfVxuXG4gICAgIFN5c3RyYWNlLmJlZ2luRXZlbnQocHJvZmlsZU5hbWUpO1xuICAgICBjb25zdCByZXQgPSBmdW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgIFN5c3RyYWNlLmVuZEV2ZW50KCk7XG4gICAgIHJldHVybiByZXQ7XG4gICB9O1xuIH0sXG59O1xuXG5pZiAoX19ERVZfXykge1xuICAvLyBUaGlzIGlzIG5lZWRlZCwgYmVjYXVzZSByZXF1aXJlIGNhbGxpcyBpbiBwb2x5ZmlsbHMgYXJlIG5vdCBwcm9jZXNzZWQgYXNcbiAgLy8gb3RoZXIgZmlsZXMuIFRoZXJlZm9yZSwgY2FsbHMgdG8gYHJlcXVpcmUoJ21vZHVsZUlkJylgIGFyZSBub3QgcmVwbGFjZWRcbiAgLy8gd2l0aCBudW1lcmljIElEc1xuICAvLyBUT0RPKGRhdmlkYXVyZWxpbykgU2NhbiBwb2x5ZmlsbHMgZm9yIGRlcGVuZGVuY2llcywgdG9vICh0OTc1OTY4NilcbiAgKHJlcXVpcmU6IGFueSkuU3lzdHJhY2UgPSBTeXN0cmFjZTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBTeXN0cmFjZTtcbiJdfQ==