5cbc2ca1b433cdcd5d3ef042d533f68f











'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}











var PixelRatio=require('PixelRatio');
var Platform=require('Platform');

var assetPathUtils=require('../../local-cli/bundle/assetPathUtils');
var invariant=require('fbjs/lib/invariant');




function getScaledAssetPath(asset){
var scale=AssetSourceResolver.pickScale(asset.scales,PixelRatio.get());
var scaleSuffix=scale===1?'':'@'+scale+'x';
var assetDir=assetPathUtils.getBasePath(asset);
return assetDir+'/'+asset.name+scaleSuffix+'.'+asset.type;
}




function getAssetPathInDrawableFolder(asset){
var scale=AssetSourceResolver.pickScale(asset.scales,PixelRatio.get());
var drawbleFolder=assetPathUtils.getAndroidResourceFolderName(asset,scale);
var fileName=assetPathUtils.getAndroidResourceIdentifier(asset);
return drawbleFolder+'/'+fileName+'.'+asset.type;
}var

AssetSourceResolver=function(){







function AssetSourceResolver(serverUrl,bundleUrl,asset){_classCallCheck(this,AssetSourceResolver);
this.serverUrl=serverUrl;
this.bundleUrl=bundleUrl;
this.asset=asset;
}_createClass(AssetSourceResolver,[{key:'isLoadedFromServer',value:function isLoadedFromServer()

{
return!!this.serverUrl;
}},{key:'isLoadedFromFileSystem',value:function isLoadedFromFileSystem()

{
return!!this.bundleUrl;
}},{key:'defaultAsset',value:function defaultAsset()

{
if(this.isLoadedFromServer()){
return this.assetServerURL();
}

if(Platform.OS==='android'){
return this.isLoadedFromFileSystem()?
this.drawableFolderInBundle():
this.resourceIdentifierWithoutScale();
}else{
return this.scaledAssetURLInBundle();
}
}},{key:'assetServerURL',value:function assetServerURL()





{
invariant(!!this.serverUrl,'need server to load from');
return this.fromSource(
this.serverUrl+getScaledAssetPath(this.asset)+
'?platform='+Platform.OS+'&hash='+this.asset.hash);

}},{key:'scaledAssetPath',value:function scaledAssetPath()





{
return this.fromSource(getScaledAssetPath(this.asset));
}},{key:'scaledAssetURLInBundle',value:function scaledAssetURLInBundle()





{
var path=this.bundleUrl||'file://';
return this.fromSource(path+getScaledAssetPath(this.asset));
}},{key:'resourceIdentifierWithoutScale',value:function resourceIdentifierWithoutScale()







{
invariant(Platform.OS==='android','resource identifiers work on Android');
return this.fromSource(assetPathUtils.getAndroidResourceIdentifier(this.asset));
}},{key:'drawableFolderInBundle',value:function drawableFolderInBundle()






{
var path=this.bundleUrl||'file://';
return this.fromSource(
path+getAssetPathInDrawableFolder(this.asset));

}},{key:'fromSource',value:function fromSource(

source){
return{
__packager_asset:true,
width:this.asset.width,
height:this.asset.height,
uri:source,
scale:AssetSourceResolver.pickScale(this.asset.scales,PixelRatio.get())};

}}],[{key:'pickScale',value:function pickScale(

scales,deviceScale){

for(var i=0;i<scales.length;i++){
if(scales[i]>=deviceScale){
return scales[i];
}
}




return scales[scales.length-1]||1;
}}]);return AssetSourceResolver;}();



module.exports=AssetSourceResolver;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFzc2V0U291cmNlUmVzb2x2ZXIuanMiXSwibmFtZXMiOlsiUGl4ZWxSYXRpbyIsInJlcXVpcmUiLCJQbGF0Zm9ybSIsImFzc2V0UGF0aFV0aWxzIiwiaW52YXJpYW50IiwiZ2V0U2NhbGVkQXNzZXRQYXRoIiwiYXNzZXQiLCJzY2FsZSIsIkFzc2V0U291cmNlUmVzb2x2ZXIiLCJwaWNrU2NhbGUiLCJzY2FsZXMiLCJnZXQiLCJzY2FsZVN1ZmZpeCIsImFzc2V0RGlyIiwiZ2V0QmFzZVBhdGgiLCJuYW1lIiwidHlwZSIsImdldEFzc2V0UGF0aEluRHJhd2FibGVGb2xkZXIiLCJkcmF3YmxlRm9sZGVyIiwiZ2V0QW5kcm9pZFJlc291cmNlRm9sZGVyTmFtZSIsImZpbGVOYW1lIiwiZ2V0QW5kcm9pZFJlc291cmNlSWRlbnRpZmllciIsInNlcnZlclVybCIsImJ1bmRsZVVybCIsImlzTG9hZGVkRnJvbVNlcnZlciIsImFzc2V0U2VydmVyVVJMIiwiT1MiLCJpc0xvYWRlZEZyb21GaWxlU3lzdGVtIiwiZHJhd2FibGVGb2xkZXJJbkJ1bmRsZSIsInJlc291cmNlSWRlbnRpZmllcldpdGhvdXRTY2FsZSIsInNjYWxlZEFzc2V0VVJMSW5CdW5kbGUiLCJmcm9tU291cmNlIiwiaGFzaCIsInBhdGgiLCJzb3VyY2UiLCJfX3BhY2thZ2VyX2Fzc2V0Iiwid2lkdGgiLCJoZWlnaHQiLCJ1cmkiLCJkZXZpY2VTY2FsZSIsImkiLCJsZW5ndGgiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQVdBLGE7Ozs7Ozs7Ozs7OztBQVlBLEdBQU1BLFlBQWFDLFFBQVEsWUFBUixDQUFuQjtBQUNBLEdBQU1DLFVBQVdELFFBQVEsVUFBUixDQUFqQjs7QUFFQSxHQUFNRSxnQkFBaUJGLFFBQVEsdUNBQVIsQ0FBdkI7QUFDQSxHQUFNRyxXQUFZSCxRQUFRLG9CQUFSLENBQWxCOzs7OztBQUtBLFFBQVNJLG1CQUFULENBQTRCQyxLQUE1QixDQUEyQztB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SUFEYjtBQUVMQyxNQUFPLEtBQUs5QixLQUFMLENBQVc4QixLQUZiO0FBR0xDLE9BQVEsS0FBSy9CLEtBQUwsQ0FBVytCLE1BSGQ7QUFJTEMsSUFBS0osTUFKQTtBQUtMM0IsTUFBT0Msb0JBQW9CQyxTQUFwQixDQUE4QixLQUFLSCxLQUFMLENBQVdJLE1BQXpDLENBQWlEVixXQUFXVyxHQUFYLEVBQWpELENBTEYsQ0FBUDs7QUFPRCxDOztBQUVnQkQsTSxDQUF1QjZCLFcsQ0FBNkI7O0FBRW5FLElBQUssR0FBSUMsR0FBSSxDQUFiLENBQWdCQSxFQUFJOUIsT0FBTytCLE1BQTNCLENBQW1DRCxHQUFuQyxDQUF3QztBQUN0QyxHQUFJOUIsT0FBTzhCLENBQVAsR0FBYUQsV0FBakIsQ0FBOEI7QUFDNUIsTUFBTzdCLFFBQU84QixDQUFQLENBQVA7QUFDRDtBQUNGOzs7OztBQUtELE1BQU85QixRQUFPQSxPQUFPK0IsTUFBUCxDQUFnQixDQUF2QixHQUE2QixDQUFwQztBQUNELEM7Ozs7QUFJRkMsT0FBT0MsT0FBUCxDQUFpQm5DLG1CQUFqQiIsImZpbGUiOiJBc3NldFNvdXJjZVJlc29sdmVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuIEFuIGFkZGl0aW9uYWwgZ3JhbnRcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxuICpcbiAqIEBwcm92aWRlc01vZHVsZSBBc3NldFNvdXJjZVJlc29sdmVyXG4gKiBAZmxvd1xuICovXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydCB0eXBlIFJlc29sdmVkQXNzZXRTb3VyY2UgPSB7XG4gIF9fcGFja2FnZXJfYXNzZXQ6IGJvb2xlYW4sXG4gIHdpZHRoOiA/bnVtYmVyLFxuICBoZWlnaHQ6ID9udW1iZXIsXG4gIHVyaTogc3RyaW5nLFxuICBzY2FsZTogbnVtYmVyLFxufTtcblxuaW1wb3J0IHR5cGUgeyBQYWNrYWdlckFzc2V0IH0gZnJvbSAnQXNzZXRSZWdpc3RyeSc7XG5cbmNvbnN0IFBpeGVsUmF0aW8gPSByZXF1aXJlKCdQaXhlbFJhdGlvJyk7XG5jb25zdCBQbGF0Zm9ybSA9IHJlcXVpcmUoJ1BsYXRmb3JtJyk7XG5cbmNvbnN0IGFzc2V0UGF0aFV0aWxzID0gcmVxdWlyZSgnLi4vLi4vbG9jYWwtY2xpL2J1bmRsZS9hc3NldFBhdGhVdGlscycpO1xuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnZmJqcy9saWIvaW52YXJpYW50Jyk7XG5cbi8qKlxuICogUmV0dXJucyBhIHBhdGggbGlrZSAnYXNzZXRzL0F3ZXNvbWVNb2R1bGUvaWNvbkAyeC5wbmcnXG4gKi9cbmZ1bmN0aW9uIGdldFNjYWxlZEFzc2V0UGF0aChhc3NldCk6IHN0cmluZyB7XG4gIHZhciBzY2FsZSA9IEFzc2V0U291cmNlUmVzb2x2ZXIucGlja1NjYWxlKGFzc2V0LnNjYWxlcywgUGl4ZWxSYXRpby5nZXQoKSk7XG4gIHZhciBzY2FsZVN1ZmZpeCA9IHNjYWxlID09PSAxID8gJycgOiAnQCcgKyBzY2FsZSArICd4JztcbiAgdmFyIGFzc2V0RGlyID0gYXNzZXRQYXRoVXRpbHMuZ2V0QmFzZVBhdGgoYXNzZXQpO1xuICByZXR1cm4gYXNzZXREaXIgKyAnLycgKyBhc3NldC5uYW1lICsgc2NhbGVTdWZmaXggKyAnLicgKyBhc3NldC50eXBlO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBwYXRoIGxpa2UgJ2RyYXdhYmxlLW1kcGkvaWNvbi5wbmcnXG4gKi9cbmZ1bmN0aW9uIGdldEFzc2V0UGF0aEluRHJhd2FibGVGb2xkZXIoYXNzZXQpOiBzdHJpbmcge1xuICB2YXIgc2NhbGUgPSBBc3NldFNvdXJjZVJlc29sdmVyLnBpY2tTY2FsZShhc3NldC5zY2FsZXMsIFBpeGVsUmF0aW8uZ2V0KCkpO1xuICB2YXIgZHJhd2JsZUZvbGRlciA9IGFzc2V0UGF0aFV0aWxzLmdldEFuZHJvaWRSZXNvdXJjZUZvbGRlck5hbWUoYXNzZXQsIHNjYWxlKTtcbiAgdmFyIGZpbGVOYW1lID0gIGFzc2V0UGF0aFV0aWxzLmdldEFuZHJvaWRSZXNvdXJjZUlkZW50aWZpZXIoYXNzZXQpO1xuICByZXR1cm4gZHJhd2JsZUZvbGRlciArICcvJyArIGZpbGVOYW1lICsgJy4nICsgYXNzZXQudHlwZTtcbn1cblxuY2xhc3MgQXNzZXRTb3VyY2VSZXNvbHZlciB7XG5cbiAgc2VydmVyVXJsOiA/c3RyaW5nO1xuICAvLyB3aGVyZSB0aGUgYnVuZGxlIGlzIGJlaW5nIHJ1biBmcm9tXG4gIGJ1bmRsZVVybDogP3N0cmluZztcbiAgLy8gdGhlIGFzc2V0IHRvIHJlc29sdmVcbiAgYXNzZXQ6IFBhY2thZ2VyQXNzZXQ7XG5cbiAgY29uc3RydWN0b3Ioc2VydmVyVXJsOiA/c3RyaW5nLCBidW5kbGVVcmw6ID9zdHJpbmcsIGFzc2V0OiBQYWNrYWdlckFzc2V0KSB7XG4gICAgdGhpcy5zZXJ2ZXJVcmwgPSBzZXJ2ZXJVcmw7XG4gICAgdGhpcy5idW5kbGVVcmwgPSBidW5kbGVVcmw7XG4gICAgdGhpcy5hc3NldCA9IGFzc2V0O1xuICB9XG5cbiAgaXNMb2FkZWRGcm9tU2VydmVyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIXRoaXMuc2VydmVyVXJsO1xuICB9XG5cbiAgaXNMb2FkZWRGcm9tRmlsZVN5c3RlbSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gISF0aGlzLmJ1bmRsZVVybDtcbiAgfVxuXG4gIGRlZmF1bHRBc3NldCgpOiBSZXNvbHZlZEFzc2V0U291cmNlIHtcbiAgICBpZiAodGhpcy5pc0xvYWRlZEZyb21TZXJ2ZXIoKSkge1xuICAgICAgcmV0dXJuIHRoaXMuYXNzZXRTZXJ2ZXJVUkwoKTtcbiAgICB9XG5cbiAgICBpZiAoUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJykge1xuICAgICAgcmV0dXJuIHRoaXMuaXNMb2FkZWRGcm9tRmlsZVN5c3RlbSgpID9cbiAgICAgICAgdGhpcy5kcmF3YWJsZUZvbGRlckluQnVuZGxlKCkgOlxuICAgICAgICB0aGlzLnJlc291cmNlSWRlbnRpZmllcldpdGhvdXRTY2FsZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5zY2FsZWRBc3NldFVSTEluQnVuZGxlKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYW4gYWJzb2x1dGUgVVJMIHdoaWNoIGNhbiBiZSB1c2VkIHRvIGZldGNoIHRoZSBhc3NldFxuICAgKiBmcm9tIHRoZSBkZXZzZXJ2ZXJcbiAgICovXG4gIGFzc2V0U2VydmVyVVJMKCk6IFJlc29sdmVkQXNzZXRTb3VyY2Uge1xuICAgIGludmFyaWFudCghIXRoaXMuc2VydmVyVXJsLCAnbmVlZCBzZXJ2ZXIgdG8gbG9hZCBmcm9tJyk7XG4gICAgcmV0dXJuIHRoaXMuZnJvbVNvdXJjZShcbiAgICAgIHRoaXMuc2VydmVyVXJsICsgZ2V0U2NhbGVkQXNzZXRQYXRoKHRoaXMuYXNzZXQpICtcbiAgICAgICc/cGxhdGZvcm09JyArIFBsYXRmb3JtLk9TICsgJyZoYXNoPScgKyB0aGlzLmFzc2V0Lmhhc2hcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc29sdmVzIHRvIGp1c3QgdGhlIHNjYWxlZCBhc3NldCBmaWxlbmFtZVxuICAgKiBFLmcuICdhc3NldHMvQXdlc29tZU1vZHVsZS9pY29uQDJ4LnBuZydcbiAgICovXG4gIHNjYWxlZEFzc2V0UGF0aCgpOiBSZXNvbHZlZEFzc2V0U291cmNlIHtcbiAgICByZXR1cm4gdGhpcy5mcm9tU291cmNlKGdldFNjYWxlZEFzc2V0UGF0aCh0aGlzLmFzc2V0KSk7XG4gIH1cblxuICAvKipcbiAgICogUmVzb2x2ZXMgdG8gd2hlcmUgdGhlIGJ1bmRsZSBpcyBydW5uaW5nIGZyb20sIHdpdGggYSBzY2FsZWQgYXNzZXQgZmlsZW5hbWVcbiAgICogRS5nLiAnZmlsZTovLy9zZGNhcmQvYnVuZGxlL2Fzc2V0cy9Bd2Vzb21lTW9kdWxlL2ljb25AMngucG5nJ1xuICAgKi9cbiAgc2NhbGVkQXNzZXRVUkxJbkJ1bmRsZSgpOiBSZXNvbHZlZEFzc2V0U291cmNlIHtcbiAgICBjb25zdCBwYXRoID0gdGhpcy5idW5kbGVVcmwgfHwgJ2ZpbGU6Ly8nO1xuICAgIHJldHVybiB0aGlzLmZyb21Tb3VyY2UocGF0aCArIGdldFNjYWxlZEFzc2V0UGF0aCh0aGlzLmFzc2V0KSk7XG4gIH1cblxuICAvKipcbiAgICogVGhlIGRlZmF1bHQgbG9jYXRpb24gb2YgYXNzZXRzIGJ1bmRsZWQgd2l0aCB0aGUgYXBwLCBsb2NhdGVkIGJ5XG4gICAqIHJlc291cmNlIGlkZW50aWZpZXJcbiAgICogVGhlIEFuZHJvaWQgcmVzb3VyY2Ugc3lzdGVtIHBpY2tzIHRoZSBjb3JyZWN0IHNjYWxlLlxuICAgKiBFLmcuICdhc3NldHNfYXdlc29tZW1vZHVsZV9pY29uJ1xuICAgKi9cbiAgcmVzb3VyY2VJZGVudGlmaWVyV2l0aG91dFNjYWxlKCk6IFJlc29sdmVkQXNzZXRTb3VyY2Uge1xuICAgIGludmFyaWFudChQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnLCAncmVzb3VyY2UgaWRlbnRpZmllcnMgd29yayBvbiBBbmRyb2lkJyk7XG4gICAgcmV0dXJuIHRoaXMuZnJvbVNvdXJjZShhc3NldFBhdGhVdGlscy5nZXRBbmRyb2lkUmVzb3VyY2VJZGVudGlmaWVyKHRoaXMuYXNzZXQpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJZiB0aGUganNidW5kbGUgaXMgcnVubmluZyBmcm9tIGEgc2lkZWxvYWQgbG9jYXRpb24sIHRoaXMgcmVzb2x2ZXMgYXNzZXRzXG4gICAqIHJlbGF0aXZlIHRvIGl0cyBsb2NhdGlvblxuICAgKiBFLmcuICdmaWxlOi8vL3NkY2FyZC9Bd2Vzb21lTW9kdWxlL2RyYXdhYmxlLW1kcGkvaWNvbi5wbmcnXG4gICAqL1xuICBkcmF3YWJsZUZvbGRlckluQnVuZGxlKCk6IFJlc29sdmVkQXNzZXRTb3VyY2Uge1xuICAgIGNvbnN0IHBhdGggPSB0aGlzLmJ1bmRsZVVybCB8fCAnZmlsZTovLyc7XG4gICAgcmV0dXJuIHRoaXMuZnJvbVNvdXJjZShcbiAgICAgIHBhdGggKyBnZXRBc3NldFBhdGhJbkRyYXdhYmxlRm9sZGVyKHRoaXMuYXNzZXQpXG4gICAgKTtcbiAgfVxuXG4gIGZyb21Tb3VyY2Uoc291cmNlOiBzdHJpbmcpOiBSZXNvbHZlZEFzc2V0U291cmNlIHtcbiAgICByZXR1cm4ge1xuICAgICAgX19wYWNrYWdlcl9hc3NldDogdHJ1ZSxcbiAgICAgIHdpZHRoOiB0aGlzLmFzc2V0LndpZHRoLFxuICAgICAgaGVpZ2h0OiB0aGlzLmFzc2V0LmhlaWdodCxcbiAgICAgIHVyaTogc291cmNlLFxuICAgICAgc2NhbGU6IEFzc2V0U291cmNlUmVzb2x2ZXIucGlja1NjYWxlKHRoaXMuYXNzZXQuc2NhbGVzLCBQaXhlbFJhdGlvLmdldCgpKSxcbiAgICB9O1xuICB9XG5cbiAgc3RhdGljIHBpY2tTY2FsZShzY2FsZXM6IEFycmF5PG51bWJlcj4sIGRldmljZVNjYWxlOiBudW1iZXIpOiBudW1iZXIge1xuICAgIC8vIFBhY2thZ2VyIGd1YXJhbnRlZXMgdGhhdCBgc2NhbGVzYCBhcnJheSBpcyBzb3J0ZWRcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNjYWxlcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKHNjYWxlc1tpXSA+PSBkZXZpY2VTY2FsZSkge1xuICAgICAgICByZXR1cm4gc2NhbGVzW2ldO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIElmIG5vdGhpbmcgbWF0Y2hlcywgZGV2aWNlIHNjYWxlIGlzIGxhcmdlciB0aGFuIGFueSBhdmFpbGFibGVcbiAgICAvLyBzY2FsZXMsIHNvIHdlIHJldHVybiB0aGUgYmlnZ2VzdCBvbmUuIFVubGVzcyB0aGUgYXJyYXkgaXMgZW1wdHksXG4gICAgLy8gaW4gd2hpY2ggY2FzZSB3ZSBkZWZhdWx0IHRvIDFcbiAgICByZXR1cm4gc2NhbGVzW3NjYWxlcy5sZW5ndGggLSAxXSB8fCAxO1xuICB9XG5cbn1cblxuIG1vZHVsZS5leHBvcnRzID0gQXNzZXRTb3VyY2VSZXNvbHZlcjtcbiJdfQ==